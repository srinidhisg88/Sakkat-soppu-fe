import{j as e,m as t,A as a}from"./ui-vendor-090db037.js";import{r,u as n,b as s}from"./react-vendor-e826ac9a.js";import{u as i,a as l,g as o,b as c}from"./index-afee60cc.js";import{d,a as m}from"./format-01d13a2f.js";import{P as u}from"./ProductCard-be221544.js";import{E as p}from"./EmptyState-1e8ab27c.js";import{P as g}from"./Pagination-51ac7225.js";import{u as h}from"./data-vendor-7193eb6f.js";import"./useAddToCartBar-37ada366.js";function f({title:e,titleId:t,...a},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const x=r.forwardRef(f);function y({title:e,titleId:t,...a},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const v=r.forwardRef(y),b={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}};function j(){var f,y,j;const{items:w}=i(),[N,L]=r.useState("All"),[S,C]=r.useState(""),A=n(),E=s(),P=new URLSearchParams(A.search),M=Math.max(1,Number(P.get("page")||1)),k=Math.max(1,Number(P.get("limit")||24)),[F,O]=r.useState(M),R=k,[T,B]=r.useState("");r.useEffect(()=>{const e=setTimeout(()=>B(S.trim()),350);return()=>clearTimeout(e)},[S]),r.useEffect(()=>{O(1)},[T]),r.useEffect(()=>{const e=new URLSearchParams(A.search);e.set("page",String(F)),e.set("limit",String(R));const t=e.toString();t!==A.search.replace(/^\?/,"")&&E({pathname:A.pathname,search:t},{replace:!0})},[F,R,A.pathname,A.search,E]);const _=T.length>0,{data:q,isLoading:I,isError:U,refetch:D,isFetching:W}=h({queryKey:["products",{page:F,limit:R,search:T||void 0}],queryFn:async()=>(await o({page:F,limit:R,search:T||void 0})).data,keepPreviousData:!0,retry:(e,t)=>{var a;return 429===(null==(a=null==t?void 0:t.response)?void 0:a.status)?e<1:e<2},retryDelay:e=>Math.min(1e3*2**e,5e3),refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1,enabled:!_}),K=null!=(f=null==q?void 0:q.products)?f:[],[Z,z]=r.useState(null),[V,G]=r.useState(!1);r.useEffect(()=>{let e=!1;return async function(){if(_){G(!0);try{const t=(await o({page:1,limit:100})).data,a=Math.max(1,t.totalPages),r=10;if(a<=1)e||z(t.products);else{const n=[t.products];for(let e=2;e<=Math.min(a,r);e++){const t=(await o({page:e,limit:100})).data;n.push(t.products)}e||z(n.flat())}}catch(t){e||z([])}finally{e||G(!1)}}else z(null)}(),()=>{e=!0}},[_]);const{data:H=[]}=h({queryKey:["categories","list"],queryFn:async()=>{var e,t;const a=(await c()).data;return Array.isArray(a)?a:null!=(t=null!=(e=null==a?void 0:a.data)?e:null==a?void 0:a.categories)?t:[]},staleTime:3e5,cacheTime:6e5}),J=r.useMemo(()=>{const e=new Map;return H.forEach(t=>e.set(t._id,t)),e},[H]),Q=(_?null!=Z?Z:[]:K).map(e=>{var t,a,r,n,s;return{...e,category:e.category&&e.category.trim()||e.categoryId&&(null==(t=J.get(e.categoryId))?void 0:t.name)||e.category,unitLabel:d({unitLabel:e.unitLabel,g:null!=(a=e.g)?a:null,pieces:null!=(r=e.pieces)?r:null})||e.unitLabel,priceForUnitLabel:m(e.price,{g:null!=(n=e.g)?n:null,unitLabel:null!=(s=e.unitLabel)?s:null})||e.priceForUnitLabel}}),X=r.useMemo(()=>{var e;const t=new Set;if(H.length>0)H.forEach(e=>t.add(e.name));else for(const a of Q){const r=(null!=(e=a.category)?e:"").toString().trim();r&&t.add(r)}return Array.from(t).sort((e,t)=>e.localeCompare(t))},[Q,H]),Y=r.useMemo(()=>["All",...X],[X]);r.useEffect(()=>{"All"===N||X.some(e=>e.toLowerCase().trim()===N.toLowerCase().trim())||L("All")},[X,N]);const $=Q.filter(e=>{var t,a,r;const n=(null!=(t=e.category)?t:"").toString().toLowerCase().trim(),s=(null!=N?N:"All").toString().toLowerCase().trim(),i=(null!=S?S:"").toString().toLowerCase().trim(),l="all"===s||n===s,o=(null!=(a=e.name)?a:"").toString(),c=(null!=(r=e.description)?r:"").toString(),d=""===i||o.toLowerCase().includes(i)||c.toLowerCase().includes(i);return l&&d}).sort((e,t)=>e.name.localeCompare(t.name)),ee=_?$.length:null!=(y=null==q?void 0:q.total)?y:$.length,te=_?Math.max(1,Math.ceil(ee/R)):null!=(j=null==q?void 0:q.totalPages)?j:1,ae=_?$.slice((F-1)*R,F*R):$;l([...ae.map(e=>e._id).filter(Boolean),...w.map(e=>e.product._id).filter(Boolean)]);const re=W||V,ne=(I||_&&null===Z)&&0===ae.length;return e.jsxs(t.div,{className:"max-w-7xl mx-auto px-3 sm:px-4 py-6 sm:py-8",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsxs(t.div,{className:"bg-gradient-to-r from-green-600 to-green-400 rounded-2xl p-5 sm:p-8 mb-6 sm:mb-8 text-white",initial:{y:-20},animate:{y:0},transition:{delay:.2},children:[e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold mb-2 sm:mb-4",children:"Our Fresh Products"}),e.jsx("p",{className:"text-green-50 text-sm sm:text-lg",children:"Discover fresh, organic produce from local farmers"})]}),e.jsx(t.div,{className:"bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"h-5 w-5 text-gray-400 absolute left-3 top-3"}),e.jsx("input",{type:"text",placeholder:"Search products...",value:S,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-3 sm:pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"h-5 w-5 text-gray-400 absolute left-3 top-3"}),e.jsx("select",{value:N,onChange:e=>{const t=e.target.value;if("All"===t)L("All");else{const e=H.find(e=>e.name===t);e&&E("/categories/".concat(e._id))}},className:"w-full pl-10 pr-3 sm:pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent appearance-none",children:Y.map(t=>e.jsx("option",{value:t,children:"All"===t?"All Products":t},t))})]})]})}),e.jsxs(t.div,{className:"flex items-center justify-between mb-4 sm:mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-green-600",children:ee})," products found"]}),U&&e.jsx("button",{onClick:()=>D(),className:"text-sm text-red-600 hover:underline",children:"Retry loading"})]}),e.jsx(a,{mode:"wait",initial:!1,children:ne?e.jsx(t.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(t.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"inline-block w-12 h-12 border-4 border-green-600 border-t-transparent rounded-full"})}):e.jsxs(t.div,{variants:b,initial:!1,animate:"visible",className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6",children:[ae.map((a,r)=>e.jsx(t.div,{layout:!0,className:"",children:e.jsx(u,{product:a})},a._id||"".concat(a.name,"-").concat(r))),0===ae.length&&e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},className:"col-span-full",children:e.jsx(p,{title:"No products found",description:"Try adjusting your search or filter criteria.",icon:e.jsx("span",{children:"ðŸ˜•"})})})]})}),e.jsx(g,{currentPage:F,totalPages:te,onPageChange:O,className:"mt-6 sm:mt-8"}),re&&e.jsx("div",{className:"fixed left-0 right-0 top-0 h-0.5 bg-gradient-to-r from-green-400 via-green-600 to-green-400 animate-pulse z-40"})]})}export{j as ProductsPage};
