import{j as e}from"./ui-vendor-090db037.js";import{b as s,r as t}from"./react-vendor-e826ac9a.js";import{d as r}from"./format-01d13a2f.js";import{b as a,n as i,a as o}from"./index-8909774e.js";import{c as n,E as l}from"./EmptyState-90642793.js";import{S as d}from"./Shimmer-954c7611.js";import{u as c}from"./data-vendor-7193eb6f.js";import{A as m}from"./ArrowLeftIcon-26eeecc0.js";import{M as x,S as p}from"./search-3268ebc4.js";
/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=n("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);function h(){const{isAuthenticated:n}=a(),h=s(),[y,f]=t.useState(""),{data:j=[],isLoading:g}=c({queryKey:["orders"],queryFn:async()=>{const e=(await i()).data;return Array.isArray(e)?e:e&&"object"==typeof e&&Array.isArray(e.data)&&e.data||[]}}),{data:b=[]}=c({queryKey:["products","for-orders"],queryFn:async()=>{const e=await o({page:1,limit:500}),s=e=>{if(Array.isArray(e))return e;if(e&&"object"==typeof e){const t=e,r=["data","products","items","results","payload"];for(const e of r)if(e in t){const r=s(t[e]);if(Array.isArray(r))return r}const a=Object.values(t).find(Array.isArray);if(a)return s(a)}return[]};return s(e.data)},staleTime:6e4}),v=new Map;for(const e of b)if(e&&"object"==typeof e){const s=e,t="string"==typeof s._id?s._id:void 0,r="string"==typeof s.id?s.id:void 0;t&&v.set(t,e),r&&v.set(r,e)}let N=j;if(!n){const e=localStorage.getItem("sakkat_orders");N=e?JSON.parse(e):[]}const w=t.useMemo(()=>{let e=N;if(y.trim()){const s=y.toLowerCase();e=e.filter(e=>(e.items||[]).some(e=>{const t=e.productId,r=("object"==typeof e.product?e.product:void 0)||v.get(t);return(e.name||(null==r?void 0:r.name)||"").toLowerCase().includes(s)}))}return e},[N,y,v]);return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm flex-shrink-0",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>h("/"),className:"p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Go back to home",children:e.jsx(m,{className:"h-6 w-6 text-gray-700"})}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"My Order"})]})}),e.jsx("div",{className:"bg-gray-50 flex-shrink-0 border-b border-gray-200",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-4",children:e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search here...",value:y,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-white rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})})})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 pb-20 md:pb-4",children:[g&&0===N.length&&e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(d,{width:"w-32",height:"h-5"}),e.jsx(d,{width:"w-24",height:"h-4"})]}),e.jsx(d,{width:"w-20",height:"h-6",className:"rounded-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{width:"w-full",height:"h-4"}),e.jsx(d,{width:"w-2/3",height:"h-4"})]})]},s))}),0!==w.length||g?null:e.jsx("div",{children:N.length>0&&y.trim()?e.jsx(l,{title:"No matching orders",description:"Try adjusting your search query.",IconComponent:p}):e.jsx(l,{title:"No Orders Yet",description:"You haven't placed any orders yet. Start shopping to place your first order!",actionLabel:"Browse Products",actionTo:"/products",IconComponent:u})}),e.jsx("div",{className:"space-y-4",children:w.map((s,t)=>{var a,i;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 border border-gray-100 animate-fade-in-scale",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:new Date(null!=(a=s.createdAt)?a:Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(()=>{const e=s.items||[];if(0===e.length)return"Order";const t=e[0],r=t.productId,a=("object"==typeof t.product?t.product:void 0)||v.get(r),i=t.name||(null==a?void 0:a.name)||"Items";return e.length>1?"".concat(i," +").concat(e.length-1," more"):i})()})]})}),e.jsx("div",{className:"mb-3 space-y-2",children:(s.items||[]).map((s,t)=>{const a=s.productId,i=("object"==typeof s.product?s.product:void 0)||v.get(a),o=s.name||(null==i?void 0:i.name)||"Item",n="number"==typeof s.g?s.g:"number"==typeof(null==i?void 0:i.g)?i.g:0,l="number"==typeof s.pieces?s.pieces:"number"==typeof(null==i?void 0:i.pieces)?i.pieces:0,d=r({unitLabel:s.unitLabel||(null==i?void 0:i.unitLabel),g:n,pieces:l});return e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:o}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Qty: ",s.quantity,d?" • ".concat(d):""]})]}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["₹",(Number(s.price)||0)*Number(s.quantity||0)]})]},String(s.productId||s.id||t))})}),e.jsxs("div",{className:"border-t border-gray-100 pt-3 space-y-1.5 text-sm",children:["number"==typeof s.subtotalPrice&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",s.subtotalPrice]})]}),s.couponCode&&"number"==typeof s.discountAmount&&s.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:["Coupon (",s.couponCode,")"]}),e.jsxs("span",{children:["-₹",s.discountAmount]})]}),"number"==typeof s.deliveryFee&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{children:0===s.deliveryFee?"Free":"₹".concat(s.deliveryFee)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Amount"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["₹",null!=(i=s.totalPrice)?i:0]})]})]}),s.address&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Delivery Address"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.address})]})]},s._id||s.id||t)})})]})})]})}export{h as OrdersPage};
