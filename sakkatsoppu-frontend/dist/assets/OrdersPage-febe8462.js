import{j as e}from"./ui-vendor-090db037.js";import{r as t}from"./react-vendor-e826ac9a.js";import{d as s}from"./format-01d13a2f.js";import{d as r,o as a,a as n}from"./index-cccb1110.js";import{E as i}from"./EmptyState-1e8ab27c.js";import{u as d}from"./data-vendor-7193eb6f.js";function l(){const{isAuthenticated:l}=r(),[c,o]=t.useState("all"),m=e=>{if(!e)return"pending";const t=String(e).trim().toLowerCase();return"canceled"===t?"cancelled":t.startsWith("deliver")?"delivered":t.startsWith("confirm")?"confirmed":t.startsWith("pend")?"pending":["pending","confirmed","delivered","cancelled"].includes(t)?t:"pending"},{data:p=[],isLoading:x}=d({queryKey:["orders"],queryFn:async()=>{const e=(await a()).data;return Array.isArray(e)?e:e&&"object"==typeof e&&Array.isArray(e.data)&&e.data||[]}}),{data:u=[]}=d({queryKey:["products","for-orders"],queryFn:async()=>{const e=await n({page:1,limit:500}),t=e=>{if(Array.isArray(e))return e;if(e&&"object"==typeof e){const s=e,r=["data","products","items","results","payload"];for(const e of r)if(e in s){const r=t(s[e]);if(Array.isArray(r))return r}const a=Object.values(s).find(Array.isArray);if(a)return t(a)}return[]};return t(e.data)},staleTime:6e4}),y=new Map;for(const e of u)if(e&&"object"==typeof e){const t=e,s="string"==typeof t._id?t._id:void 0,r="string"==typeof t.id?t.id:void 0;s&&y.set(s,e),r&&y.set(r,e)}let f=p;if(!l){const e=localStorage.getItem("sakkat_orders");f=e?JSON.parse(e):[]}const h="all"===c?f:f.filter(e=>m(e.status)===c);return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"My Orders"}),e.jsx("div",{className:"flex gap-2 mb-6 flex-wrap",children:["all","pending","confirmed","delivered","cancelled"].map(t=>e.jsx("button",{onClick:()=>o(t),className:"px-3 py-1 rounded-full text-sm ".concat(c===t?"bg-green-600 text-white":"bg-gray-100 text-gray-700"),children:t[0].toUpperCase()+t.slice(1)},t))}),x&&0===f.length&&e.jsx("div",{className:"py-4",children:e.jsx(i,{title:"Loading orders...",icon:e.jsx("span",{children:"â³"})})}),0===h.length?e.jsx("div",{className:"py-4",children:f.length>0&&"all"!==c?e.jsx(i,{title:'No orders with status "'.concat(c,'"'),description:"Try switching the status filter to see other orders.",icon:e.jsx("span",{children:"ðŸ”Ž"})}):e.jsx(i,{title:"No Orders Yet",description:"You haven't placed any orders yet. Start shopping to place your first order!",actionLabel:"Browse Products",actionTo:"/products",icon:e.jsx("span",{children:"ðŸ§º"})})}):null,e.jsx("div",{className:"space-y-4",children:h.map(t=>{var r,a;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Order placed on"," ",new Date(null!=(r=t.createdAt)?r:Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Order ID: ",t._id||t.id]})]}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium\n                  ".concat("delivered"===m(t.status)?"bg-green-100 text-green-800":"cancelled"===m(t.status)?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800","\n                "),children:(()=>{const e=m(t.status);return e.charAt(0).toUpperCase()+e.slice(1)})()})]}),e.jsx("div",{className:"border-t border-b py-3 mb-3",children:(t.items||[]).map(t=>e.jsxs("div",{className:"flex justify-between items-center py-1.5",children:[e.jsx("div",{children:(()=>{const r=t.productId,a=("object"==typeof t.product?t.product:void 0)||y.get(r),n=t.name||(null==a?void 0:a.name)||"Item",i="number"==typeof t.g?t.g:"number"==typeof(null==a?void 0:a.g)?a.g:0,d="number"==typeof t.pieces?t.pieces:"number"==typeof(null==a?void 0:a.pieces)?a.pieces:0,l=s({unitLabel:t.unitLabel||(null==a?void 0:a.unitLabel),g:i,pieces:d});return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-sm",children:n}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Qty: ",t.quantity,l?" â€¢ for ".concat(l):""]})]})})()}),e.jsxs("p",{className:"font-medium text-sm",children:["â‚¹",(Number(t.price)||0)*Number(t.quantity||0)]})]},String(t.productId||t.id||Math.random())))}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:["number"==typeof t.subtotalPrice&&e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["â‚¹",t.subtotalPrice]})]}),t.couponCode&&"number"==typeof t.discountAmount&&t.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-green-700",children:[e.jsxs("span",{children:["Coupon (",t.couponCode,")"]}),e.jsxs("span",{children:["-â‚¹",t.discountAmount]})]}),"number"==typeof t.deliveryFee&&e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{children:0===t.deliveryFee?"Free":"â‚¹".concat(t.deliveryFee)})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Delivery Address"}),e.jsx("p",{className:"mt-0.5 text-sm",children:t.address})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-lg font-bold",children:["â‚¹",null!=(a=t.totalPrice)?a:0]})]})]})]},t._id||t.id)})})]})}export{l as OrdersPage};
