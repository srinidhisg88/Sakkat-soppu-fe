import{j as e,m as a}from"./ui-vendor-090db037.js";import{f as t,r as s,b as l,u as r}from"./react-vendor-e826ac9a.js";import{d as i,a as n}from"./format-01d13a2f.js";import{u as c,b as d,c as o,d as m,e as h,f as x}from"./index-60e49c5c.js";import{u as g}from"./useAddToCartBar-9a692299.js";import{S as u}from"./Shimmer-954c7611.js";import{u as y}from"./data-vendor-7193eb6f.js";function p(){var p,f,b,j,v,w,N;const{id:k}=t(),[C,q]=s.useState(1),{addToCart:M,updateQuantity:A,items:_}=c(),{isAuthenticated:F}=d(),{show:I}=o(),{showBar:S}=g(),L=l(),P=r(),{data:O,isLoading:T}=y({queryKey:["product",k],enabled:!!k,queryFn:async()=>(await h(k)).data});m([...(null==O?void 0:O._id)?[O._id]:[],..._.map(e=>e.product._id)]);const{data:U=[]}=y({queryKey:["categories","list"],queryFn:async()=>{var e,a;const t=(await x()).data;return Array.isArray(t)?t:null!=(a=null!=(e=null==t?void 0:t.data)?e:null==t?void 0:t.categories)?a:[]},staleTime:6e5}),E=s.useMemo(()=>{const e=new Set,a=a=>{a&&(Array.isArray(a)?a.forEach(a=>{const t="string"==typeof a?a:"";t&&e.add(t)}):"string"==typeof a&&e.add(a))};if(O){a(O.imageUrl),a(O.images);const e=O;a(e.image),a(e.imageURLs),a(e.imageUrls),a(e.gallery)}return Array.from(e)},[O]),[B,D]=s.useState(0),[H,K]=s.useState(null),Q=s.useCallback(e=>0===E.length?0:Math.max(0,Math.min(E.length-1,e)),[E.length]),R=s.useCallback(()=>{D(e=>(e-1+E.length)%Math.max(1,E.length))},[E.length]),V=s.useCallback(()=>{D(e=>(e+1)%Math.max(1,E.length))},[E.length]);s.useEffect(()=>{0!==E.length?B>=E.length&&D(0):0!==B&&D(0)},[E.length,B]),s.useEffect(()=>{let e=!1;if(!E||0===E.length)return K(1),()=>{e=!0};return(async()=>{const a=E.map(e=>new Promise(a=>{const t=new Image;t.onload=()=>{const e=t.naturalWidth||1,s=t.naturalHeight||1;a(s/e||1)},t.onerror=()=>a(1),t.src=e})),t=await Promise.all(a);if(!e){const e=Math.max(1,...t);K(Number.isFinite(e)?e:1)}})(),()=>{e=!0}},[E]);const W=E[Q(B)]||(null==O?void 0:O.imageUrl)||"";if(T&&!O)return e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{width:"w-full",height:"h-96",className:"rounded-xl"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(a=>e.jsx(u,{width:"w-20",height:"h-20",className:"rounded-lg"},a))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{width:"w-3/4",height:"h-8"}),e.jsx(u,{width:"w-1/2",height:"h-6"}),e.jsx(u,{width:"w-full",height:"h-4"}),e.jsx(u,{width:"w-full",height:"h-4"}),e.jsx(u,{width:"w-2/3",height:"h-4"}),e.jsx(u,{width:"w-32",height:"h-10",className:"rounded-lg mt-6"})]})]})});if(!O)return e.jsx("div",{className:"text-center py-8",children:"Product not found."});const z=(null==(p=_.find(e=>e.productId===O._id))?void 0:p.quantity)||0,G=Number(null!=(f=null==O?void 0:O.stock)?f:0),J=Math.max(0,G-z),X=z>0,Y=O?i({unitLabel:O.unitLabel,g:null!=(b=O.g)?b:null,pieces:null!=(j=O.pieces)?j:null}):void 0,Z=O?n(O.price,{g:null!=(v=O.g)?v:null,unitLabel:null!=(w=O.unitLabel)?w:null}):void 0,$=(null==O?void 0:O.category)&&O.category.trim()||(null==O?void 0:O.categoryId)&&(null==(N=U.find(e=>e._id===O.categoryId))?void 0:N.name)||(null==O?void 0:O.category);return e.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group w-full rounded-lg shadow-md bg-white overflow-hidden",style:{aspectRatio:null!=H?H:1},children:[e.jsx("img",{src:W,alt:O.name,className:"absolute inset-0 w-full h-full object-contain"}),E.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button","aria-label":"Previous image",onClick:R,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"‹"}),e.jsx("button",{type:"button","aria-label":"Next image",onClick:V,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"›"})]})]}),E.length>1&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-5 lg:grid-cols-6 gap-2",children:E.map((a,t)=>{const s=t===B;return e.jsxs("button",{type:"button",onClick:()=>D(t),className:"relative w-full aspect-square rounded overflow-hidden ring-2 ".concat(s?"ring-green-500":"ring-transparent"),"aria-label":"Show image ".concat(t+1),children:[e.jsx("img",{src:a,alt:"".concat(O.name," ").concat(t+1),className:"w-full h-full object-cover"}),s&&e.jsx("span",{className:"absolute inset-0 ring-2 ring-green-500 rounded pointer-events-none"})]},t)})})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:O.name}),e.jsx("p",{className:"text-gray-600 mt-1 sm:mt-2",children:$})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-xl sm:text-2xl font-bold",children:["₹",O.price]}),Y&&e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 ml-2",children:["for ",Y]}),Z&&e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:Z})]}),O.isOrganic&&e.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Organic"})]}),e.jsx("div",{children:e.jsx("p",{className:"text-gray-700",children:O.description})}),X?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-700 mb-2",children:"In your cart"}),e.jsxs("div",{className:"flex items-center bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("button",{onClick:async()=>{try{await A(O._id,z-1)}catch(e){I("Failed to update quantity",{type:"error"})}},className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Decrease quantity",children:"−"}),e.jsx("span",{className:"flex-1 text-center font-medium text-base",children:z}),e.jsx("button",{onClick:async()=>{if(z+1>G)I("Cannot exceed available stock",{type:"warning"});else try{await A(O._id,z+1)}catch(e){I("Failed to update quantity",{type:"error"})}},className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Increase quantity",children:"+"})]})]}):e.jsxs(e.Fragment,{children:[J>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Quantity"}),e.jsxs("div",{className:"flex items-center bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("button",{onClick:()=>q(Math.max(1,C-1)),className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Decrease quantity",children:"−"}),e.jsx("span",{className:"flex-1 text-center font-medium text-base",children:C}),e.jsx("button",{onClick:()=>{J<=0?I("No more stock available for this item",{type:"warning"}):C>=J?(I("Cannot exceed available stock",{type:"warning"}),q(Math.max(1,J))):q(C+1)},className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Increase quantity",children:"+"})]})]}),e.jsx(a.button,{onClick:async()=>{var e;if(O)if(F)try{const a=(null==(e=_.find(e=>e.productId===O._id))?void 0:e.quantity)||0,t=Math.max(0,(O.stock||0)-a);if(t<=0)return void I("No more stock available for this item",{type:"warning"});const s=Math.min(C,t);s<C&&I("Only ".concat(t," more pack(s) available. Added ").concat(s,"."),{type:"warning"}),await M(O._id,s),S(1)}catch(a){I("Failed to add to cart",{type:"error"})}else L("/login",{state:{from:P.pathname+P.search}})},disabled:J<=0,whileHover:J>0?{scale:1.02}:{},whileTap:J>0?{scale:.98}:{},className:"w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all ".concat(J>0?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-600 cursor-not-allowed"),children:J>0?"Add to Cart":"Out of Stock"})]})]})]}),(O.videos||[]).length>0&&e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Product Videos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(O.videos||[]).map((a,t)=>e.jsx("div",{className:"aspect-w-16 aspect-h-9",children:e.jsx("video",{src:a,controls:!0,className:"w-full rounded-lg shadow"})},t))})]})]})}export{p as ProductDetailsPage};
