import{j as e}from"./ui-vendor-090db037.js";import{f as s,b as t,r as a,L as n}from"./react-vendor-e826ac9a.js";import{e as r,n as i,a as l}from"./index-e944f7cc.js";import{d}from"./format-01d13a2f.js";import{S as o}from"./Shimmer-954c7611.js";import{u as c}from"./data-vendor-7193eb6f.js";const m={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"};function x(){var x,h;const{id:u}=s(),p=t(),{data:f=[],isLoading:g,isFetching:j}=c({queryKey:["orders"],queryFn:async()=>{const e=(await i()).data;return Array.isArray(e)?e:e&&"object"==typeof e&&Array.isArray(e.data)&&e.data||[]}}),{data:y=[]}=c({queryKey:["products","for-order-details"],queryFn:async()=>{const e=(await l({page:1,limit:500})).data;return Array.isArray(e)?e:e&&"object"==typeof e&&Array.isArray(e.data)&&e.data||[]},staleTime:6e4}),b=a.useMemo(()=>{const e=new Map;for(const s of y)if(s&&"object"==typeof s){const t=s,a="string"==typeof t._id?t._id:void 0,n="string"==typeof t.id?t.id:void 0;a&&e.set(a,s),n&&e.set(n,s)}return e},[y]),w=a.useMemo(()=>{const e=localStorage.getItem("sakkat_orders");return[...e?JSON.parse(e):[],...f].find(e=>(e._id||e.id)===u)},[u,f]),[v,N]=a.useState(new Map);return a.useEffect(()=>{let e=!1;const s=((null==w?void 0:w.items)||[]).map(e=>e.productId).filter(e=>"string"==typeof e&&!b.has(e)&&!v.has(e));if(0!==s.length)return(async()=>{const t=[];await Promise.all(s.slice(0,100).map(async e=>{try{const s=(await r(e)).data;s&&t.push([e,s])}catch(s){}})),!e&&t.length>0&&N(e=>{const s=new Map(e);for(const[a,n]of t)s.set(a,n);return s})})(),()=>{e=!0}},[null==w?void 0:w.items,b,v]),g||j?e.jsxs("div",{className:"max-w-3xl mx-auto p-6 space-y-4",children:[e.jsx(o,{width:"w-48",height:"h-8"}),e.jsxs("div",{className:"bg-white rounded-lg p-6 space-y-4",children:[e.jsx(o,{width:"w-32",height:"h-6"}),e.jsx(o,{width:"w-full",height:"h-4"}),e.jsx(o,{width:"w-full",height:"h-4"}),e.jsx(o,{width:"w-3/4",height:"h-4"})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 space-y-3",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx(o,{width:"w-16",height:"h-16",className:"rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(o,{width:"w-2/3",height:"h-4"}),e.jsx(o,{width:"w-1/3",height:"h-3"})]})]},s))})]}):w?e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold",children:"Order Details"})}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(m[w.status||"pending"]||"bg-gray-100 text-gray-800"),children:w.status||"pending"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Placed on"}),e.jsx("span",{className:"font-medium",children:new Date(null!=(x=w.createdAt)?x:Date.now()).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment mode"}),e.jsx("span",{className:"font-medium",children:"Cash on Delivery / UPI on Delivery"})]}),"number"==typeof w.subtotalPrice&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["₹",w.subtotalPrice]})]}),w.couponCode&&"number"==typeof w.discountAmount&&w.discountAmount>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Coupon (",w.couponCode,")"]}),e.jsxs("span",{className:"font-medium text-green-700",children:["-₹",w.discountAmount]})]}),"number"==typeof w.subtotalPrice&&w.subtotalPrice>0&&e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["You saved ",Math.round(w.discountAmount/w.subtotalPrice*100),"% on this order."]})]}),"number"==typeof w.deliveryFee&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Delivery Fee"}),e.jsx("span",{className:"font-medium",children:0===w.deliveryFee?"Free":"₹".concat(w.deliveryFee)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total"}),e.jsxs("span",{className:"font-semibold",children:["₹",null!=(h=w.totalPrice)?h:0]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Delivery Address"}),e.jsx("p",{className:"mb-0",children:w.address||"No address provided"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Items"}),e.jsx("div",{className:"divide-y",children:(w.items||[]).map((s,t)=>e.jsxs("div",{className:"py-3 flex justify-between items-center",children:[e.jsx("div",{children:(()=>{var t,a;const n=s.productId;let r;"string"==typeof n?r=b.get(n)||v.get(n):n&&"object"==typeof n&&(r=n);const i=(null==r?void 0:r.name)||"Item",l=d({unitLabel:null==r?void 0:r.unitLabel,g:null!=(t=null==r?void 0:r.g)?t:null,pieces:null!=(a=null==r?void 0:r.pieces)?a:null});return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:i}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity,l?" • for ".concat(l):""]})]})})()}),e.jsxs("p",{className:"font-medium",children:["₹",(s.price||0)*s.quantity]})]},t))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mt-8",children:[e.jsx(n,{to:"/products",className:"inline-flex items-center justify-center px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors shadow-md",children:"Continue Shopping"}),e.jsx(n,{to:"/orders",className:"inline-flex items-center justify-center px-6 py-3 bg-white text-green-600 border-2 border-green-600 rounded-lg font-semibold hover:bg-green-50 transition-colors shadow-md",children:"View All Orders"})]}),"pending"===w.status&&e.jsxs("div",{className:"mt-8 bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-green-800 font-semibold text-lg mb-2",children:"✓ Order Placed Successfully!"}),e.jsx("p",{className:"text-green-700 text-sm",children:"Thank you for your order. We'll notify you once it's confirmed and on its way."})]})]}):e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("p",{className:"mb-4",children:"Order not found."}),e.jsx("button",{className:"text-green-600 underline",onClick:()=>p("/orders"),children:"Back to Orders"})]})}export{x as default};
