System.register(["./ui-vendor-legacy-1ce3db5f.js","./react-vendor-legacy-40b14165.js","./format-legacy-97f32d7b.js","./index-legacy-c4ac752c.js","./useAddToCartBar-legacy-86cfb560.js","./Shimmer-legacy-990efe32.js","./data-vendor-legacy-6b4cc34b.js"],function(e,t){"use strict";var a,s,l,r,i,n,c,d,o,h,g,m,x,u,y,p,b;return{setters:[e=>{a=e.j,s=e.m},e=>{l=e.f,r=e.r,i=e.b,n=e.u},e=>{c=e.d,d=e.a},e=>{o=e.u,h=e.b,g=e.c,m=e.d,x=e.e,u=e.f},e=>{y=e.u},e=>{p=e.S},e=>{b=e.u}],execute:function(){e("ProductDetailsPage",function(){const{id:e}=l(),[t,j]=r.useState(1),{addToCart:f,updateQuantity:w,items:v}=o(),{isAuthenticated:N}=h(),{show:k}=g(),{showBar:C}=y(),q=i(),M=n(),{data:A,isLoading:S}=b({queryKey:["product",e],enabled:!!e,queryFn:async()=>(await x(e)).data});m([...A?._id?[A._id]:[],...v.map(e=>e.product._id)]);const{data:_=[]}=b({queryKey:["categories","list"],queryFn:async()=>{const e=(await u()).data;return Array.isArray(e)?e:e?.data??e?.categories??[]},staleTime:6e5}),F=r.useMemo(()=>{const e=new Set,t=t=>{t&&(Array.isArray(t)?t.forEach(t=>{const a="string"==typeof t?t:"";a&&e.add(a)}):"string"==typeof t&&e.add(t))};if(A){t(A.imageUrl),t(A.images);const e=A;t(e.image),t(e.imageURLs),t(e.imageUrls),t(e.gallery)}return Array.from(e)},[A]),[I,P]=r.useState(0),[L,$]=r.useState(null),O=r.useCallback(e=>0===F.length?0:Math.max(0,Math.min(F.length-1,e)),[F.length]),T=r.useCallback(()=>{P(e=>(e-1+F.length)%Math.max(1,F.length))},[F.length]),U=r.useCallback(()=>{P(e=>(e+1)%Math.max(1,F.length))},[F.length]);r.useEffect(()=>{0!==F.length?I>=F.length&&P(0):0!==I&&P(0)},[F.length,I]),r.useEffect(()=>{let e=!1;return F&&0!==F.length?((async()=>{const t=F.map(e=>new Promise(t=>{const a=new Image;a.onload=()=>{const e=a.naturalWidth||1,s=a.naturalHeight||1;t(s/e||1)},a.onerror=()=>t(1),a.src=e})),a=await Promise.all(t);if(!e){const e=Math.max(1,...a);$(Number.isFinite(e)?e:1)}})(),()=>{e=!0}):($(1),()=>{e=!0})},[F]);const D=F[O(I)]||A?.imageUrl||"";if(S&&!A)return a.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx(p,{width:"w-full",height:"h-96",className:"rounded-xl"}),a.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(e=>a.jsx(p,{width:"w-20",height:"h-20",className:"rounded-lg"},e))})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(p,{width:"w-3/4",height:"h-8"}),a.jsx(p,{width:"w-1/2",height:"h-6"}),a.jsx(p,{width:"w-full",height:"h-4"}),a.jsx(p,{width:"w-full",height:"h-4"}),a.jsx(p,{width:"w-2/3",height:"h-4"}),a.jsx(p,{width:"w-32",height:"h-10",className:"rounded-lg mt-6"})]})]})});if(!A)return a.jsx("div",{className:"text-center py-8",children:"Product not found."});const E=v.find(e=>e.productId===A._id)?.quantity||0,B=Number(A?.stock??0),H=Math.max(0,B-E),K=E>0,Q=A?c({unitLabel:A.unitLabel,g:A.g??null,pieces:A.pieces??null}):void 0,R=A?d(A.price,{g:A.g??null,unitLabel:A.unitLabel??null}):void 0,V=A?.category&&A.category.trim()||A?.categoryId&&_.find(e=>e._id===A.categoryId)?.name||A?.category;return a.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"relative group w-full rounded-lg shadow-md bg-white overflow-hidden",style:{aspectRatio:L??1},children:[a.jsx("img",{src:D,alt:A.name,className:"absolute inset-0 w-full h-full object-contain"}),F.length>1&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button","aria-label":"Previous image",onClick:T,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"‹"}),a.jsx("button",{type:"button","aria-label":"Next image",onClick:U,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"›"})]})]}),F.length>1&&a.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-5 lg:grid-cols-6 gap-2",children:F.map((e,t)=>{const s=t===I;return a.jsxs("button",{type:"button",onClick:()=>P(t),className:"relative w-full aspect-square rounded overflow-hidden ring-2 "+(s?"ring-green-500":"ring-transparent"),"aria-label":`Show image ${t+1}`,children:[a.jsx("img",{src:e,alt:`${A.name} ${t+1}`,className:"w-full h-full object-cover"}),s&&a.jsx("span",{className:"absolute inset-0 ring-2 ring-green-500 rounded pointer-events-none"})]},t)})})]}),a.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:A.name}),a.jsx("p",{className:"text-gray-600 mt-1 sm:mt-2",children:V})]}),a.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[a.jsxs("div",{children:[a.jsxs("span",{className:"text-xl sm:text-2xl font-bold",children:["₹",A.price]}),Q&&a.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 ml-2",children:["for ",Q]}),R&&a.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:R})]}),A.isOrganic&&a.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Organic"})]}),a.jsx("div",{children:a.jsx("p",{className:"text-gray-700",children:A.description})}),K?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"text-sm text-gray-700 mb-2",children:"In your cart"}),a.jsxs("div",{className:"flex items-center bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("button",{onClick:async()=>{try{await w(A._id,E-1)}catch{k("Failed to update quantity",{type:"error"})}},className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Decrease quantity",children:"−"}),a.jsx("span",{className:"flex-1 text-center font-medium text-base",children:E}),a.jsx("button",{onClick:async()=>{if(E+1>B)k("Cannot exceed available stock",{type:"warning"});else try{await w(A._id,E+1)}catch{k("Failed to update quantity",{type:"error"})}},className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Increase quantity",children:"+"})]})]}):a.jsxs(a.Fragment,{children:[H>0&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"text-sm text-gray-700",children:"Quantity"}),a.jsxs("div",{className:"flex items-center bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("button",{onClick:()=>j(Math.max(1,t-1)),className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Decrease quantity",children:"−"}),a.jsx("span",{className:"flex-1 text-center font-medium text-base",children:t}),a.jsx("button",{onClick:()=>{H<=0?k("No more stock available for this item",{type:"warning"}):t>=H?(k("Cannot exceed available stock",{type:"warning"}),j(Math.max(1,H))):j(t+1)},className:"w-12 h-12 flex items-center justify-center text-gray-600 hover:bg-gray-100 transition-colors text-xl","aria-label":"Increase quantity",children:"+"})]})]}),a.jsx(s.button,{onClick:async()=>{if(A)if(N)try{const e=v.find(e=>e.productId===A._id)?.quantity||0,a=Math.max(0,(A.stock||0)-e);if(a<=0)return void k("No more stock available for this item",{type:"warning"});const s=Math.min(t,a);s<t&&k(`Only ${a} more pack(s) available. Added ${s}.`,{type:"warning"}),await f(A._id,s),C(1)}catch(e){k("Failed to add to cart",{type:"error"})}else q("/login",{state:{from:M.pathname+M.search}})},disabled:H<=0,whileHover:H>0?{scale:1.02}:{},whileTap:H>0?{scale:.98}:{},className:"w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all "+(H>0?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-600 cursor-not-allowed"),children:H>0?"Add to Cart":"Out of Stock"})]})]})]}),(A.videos||[]).length>0&&a.jsxs("div",{className:"mt-12",children:[a.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Product Videos"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(A.videos||[]).map((e,t)=>a.jsx("div",{className:"aspect-w-16 aspect-h-9",children:a.jsx("video",{src:e,controls:!0,className:"w-full rounded-lg shadow"})},t))})]})]})})}}});
