System.register(["./ui-vendor-legacy-1ce3db5f.js","./react-vendor-legacy-40b14165.js","./format-legacy-97f32d7b.js","./index-legacy-0b9484d2.js","./useAddToCartBar-legacy-14850578.js","./data-vendor-legacy-6b4cc34b.js"],function(e,a){"use strict";var t,s,r,l,n,i,c,d,o,m,g,x,h,u,p,y;return{setters:[e=>{t=e.j},e=>{s=e.f,r=e.r,l=e.b,n=e.u},e=>{i=e.d,c=e.a,d=e.f},e=>{o=e.u,m=e.d,g=e.e,x=e.b,h=e.f,u=e.h},e=>{p=e.u},e=>{y=e.u}],execute:function(){e("ProductDetailsPage",function(){const{id:e}=s(),[a,b]=r.useState(1),{addToCart:f,updateQuantity:j,items:v}=o(),{isAuthenticated:N}=m(),{show:w}=g(),{showBar:k}=p(),C=l(),q=n(),{data:M,isLoading:A}=y({queryKey:["product",e],enabled:!!e,queryFn:async()=>(await h(e)).data});x([...M?._id?[M._id]:[],...v.map(e=>e.product._id)]);const{data:F=[]}=y({queryKey:["categories","list"],queryFn:async()=>{const e=(await u()).data;return Array.isArray(e)?e:e?.data??e?.categories??[]},staleTime:6e5}),_=r.useMemo(()=>{const e=new Set,a=a=>{a&&(Array.isArray(a)?a.forEach(a=>{const t="string"==typeof a?a:"";t&&e.add(t)}):"string"==typeof a&&e.add(a))};if(M){a(M.imageUrl),a(M.images);const e=M;a(e.image),a(e.imageURLs),a(e.imageUrls),a(e.gallery)}return Array.from(e)},[M]),[I,L]=r.useState(0),[P,S]=r.useState(null),O=r.useCallback(e=>0===_.length?0:Math.max(0,Math.min(_.length-1,e)),[_.length]),$=r.useCallback(()=>{L(e=>(e-1+_.length)%Math.max(1,_.length))},[_.length]),E=r.useCallback(()=>{L(e=>(e+1)%Math.max(1,_.length))},[_.length]);r.useEffect(()=>{0!==_.length?I>=_.length&&L(0):0!==I&&L(0)},[_.length,I]),r.useEffect(()=>{let e=!1;return _&&0!==_.length?((async()=>{const a=_.map(e=>new Promise(a=>{const t=new Image;t.onload=()=>{const e=t.naturalWidth||1,s=t.naturalHeight||1;a(s/e||1)},t.onerror=()=>a(1),t.src=e})),t=await Promise.all(a);if(!e){const e=Math.max(1,...t);S(Number.isFinite(e)?e:1)}})(),()=>{e=!0}):(S(1),()=>{e=!0})},[_]);const T=_[O(I)]||M?.imageUrl||"";if(A&&!M)return t.jsx("div",{className:"text-center py-8",children:"Loading product details..."});if(!M)return t.jsx("div",{className:"text-center py-8",children:"Product not found."});const U=v.find(e=>e.productId===M._id)?.quantity||0,B=Number(M?.stock??0),D=Math.max(0,B-U),K=U>0,R=M?i({unitLabel:M.unitLabel,g:M.g??null,pieces:M.pieces??null}):void 0,H=M?c(M.price,{g:M.g??null,unitLabel:M.unitLabel??null}):void 0,Q=M?.category&&M.category.trim()||M?.categoryId&&F.find(e=>e._id===M.categoryId)?.name||M?.category;return t.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative group w-full rounded-lg shadow-md bg-white overflow-hidden",style:{aspectRatio:P??1},children:[t.jsx("img",{src:T,alt:M.name,className:"absolute inset-0 w-full h-full object-contain"}),_.length>1&&t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button","aria-label":"Previous image",onClick:$,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"‹"}),t.jsx("button",{type:"button","aria-label":"Next image",onClick:E,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"›"})]})]}),_.length>1&&t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-5 lg:grid-cols-6 gap-2",children:_.map((e,a)=>{const s=a===I;return t.jsxs("button",{type:"button",onClick:()=>L(a),className:"relative w-full aspect-square rounded overflow-hidden ring-2 "+(s?"ring-green-500":"ring-transparent"),"aria-label":`Show image ${a+1}`,children:[t.jsx("img",{src:e,alt:`${M.name} ${a+1}`,className:"w-full h-full object-cover"}),s&&t.jsx("span",{className:"absolute inset-0 ring-2 ring-green-500 rounded pointer-events-none"})]},a)})})]}),t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:M.name}),t.jsx("p",{className:"text-gray-600 mt-1 sm:mt-2",children:Q})]}),t.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[t.jsxs("div",{children:[t.jsxs("span",{className:"text-xl sm:text-2xl font-bold",children:["₹",M.price]}),R&&t.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 ml-2",children:["for ",R]}),H&&t.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:H})]}),M.isOrganic&&t.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Organic"})]}),t.jsx("div",{children:t.jsx("p",{className:"text-gray-700",children:M.description})}),t.jsx("div",{className:"space-y-1",children:B>0?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-gray-800 font-medium",children:[B," packs available"]}),"number"==typeof M.g&&M.g>0&&(()=>{const e=d(M.g),a=B*M.g,s=d(a)||`${a} g`;return t.jsxs("p",{className:"text-sm text-gray-600",children:["Each pack: ",e," • Total ~",s]})})(),"number"==typeof M.pieces&&M.pieces>0&&t.jsxs("p",{className:"text-sm text-gray-600",children:["Each pack: ",M.pieces," pcs • Total ",B*M.pieces," pcs"]}),B<=5&&t.jsxs("p",{className:"text-xs text-amber-700",children:["Only ",B," left"]})]}):t.jsx("p",{className:"text-red-600 font-medium",children:"Out of stock"})}),K?t.jsx("div",{className:"space-y-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-700",children:"In your cart"}),t.jsxs("div",{className:"flex items-center border rounded overflow-hidden",children:[t.jsx("button",{onClick:async()=>{try{await j(M._id,U-1)}catch{w("Failed to update quantity",{type:"error"})}},className:"px-4 py-2 text-gray-600 hover:bg-gray-100","aria-label":"Decrease quantity",children:"-"}),t.jsx("span",{className:"px-4 py-2 min-w-[3rem] text-center",children:U}),t.jsx("button",{onClick:async()=>{if(U+1>B)w("Cannot exceed available stock",{type:"warning"});else try{await j(M._id,U+1)}catch{w("Failed to update quantity",{type:"error"})}},className:"px-4 py-2 text-gray-600 hover:bg-gray-100","aria-label":"Increase quantity",children:"+"})]})]})}):t.jsxs(t.Fragment,{children:[D>0&&t.jsx("div",{className:"flex items-center space-x-3 sm:space-x-4",children:t.jsxs("div",{className:"flex items-center border rounded",children:[t.jsx("button",{onClick:()=>b(Math.max(1,a-1)),className:"px-3 sm:px-4 py-2 text-gray-600 hover:bg-gray-100 active:scale-95",children:"-"}),t.jsx("span",{className:"px-3 sm:px-4 py-2",children:a}),t.jsx("button",{onClick:()=>{D<=0?w("No more stock available for this item",{type:"warning"}):a>=D?(w("Cannot exceed available stock",{type:"warning"}),b(Math.max(1,D))):b(a+1)},className:"px-3 sm:px-4 py-2 text-gray-600 hover:bg-gray-100 active:scale-95",children:"+"})]})}),t.jsx("button",{onClick:async()=>{if(M)if(N)try{const e=v.find(e=>e.productId===M._id)?.quantity||0,t=Math.max(0,(M.stock||0)-e);if(t<=0)return void w("No more stock available for this item",{type:"warning"});const s=Math.min(a,t);s<a&&w(`Only ${t} more pack(s) available. Added ${s}.`,{type:"warning"}),await f(M._id,s),k(1)}catch(e){w("Failed to add to cart",{type:"error"})}else C("/login",{state:{from:q.pathname+q.search}})},disabled:D<=0,className:"w-full py-3 rounded-lg font-semibold "+(D>0?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:D>0?"Add":"Out of Stock"})]})]})]}),(M.videos||[]).length>0&&t.jsxs("div",{className:"mt-12",children:[t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Product Videos"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(M.videos||[]).map((e,a)=>t.jsx("div",{className:"aspect-w-16 aspect-h-9",children:t.jsx("video",{src:e,controls:!0,className:"w-full rounded-lg shadow"})},a))})]})]})})}}});
