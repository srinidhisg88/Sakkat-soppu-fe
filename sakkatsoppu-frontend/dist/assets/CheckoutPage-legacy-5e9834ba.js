System.register(["./ui-vendor-legacy-1ce3db5f.js","./format-legacy-97f32d7b.js","./react-vendor-legacy-40b14165.js","./index-legacy-67042b98.js","./MapAddressModal-legacy-f9424c1b.js","./data-vendor-legacy-6b4cc34b.js","./map-vendor-legacy-febad625.js"],function(e,t){"use strict";var s,r,a,n,l,d,i,o,c,u,m,x,p,g,b,h,y,f,j;return{setters:[e=>{s=e.j,r=e.A,a=e.m},e=>{n=e.f},e=>{l=e.r,d=e.b},e=>{i=e.b,o=e.u,c=e.d,u=e.h,m=e.c,x=e.k,p=e.e,g=e.l,b=e.j,h=e.m},e=>{y=e.M},e=>{f=e.c,j=e.u},null],execute:function(){function t(e,t="start"){if(null==e)return null;if("number"==typeof e){const t=e>1e12?e:1e3*e;return Number.isFinite(t)?t:null}const s=String(e).trim();if(!s)return null;if(/^\d{10,13}$/.test(s)){const e=Number(s.length<=10?1e3*Number(s):Number(s));return Number.isFinite(e)?e:null}const r=/[T\s]\d{1,2}:\d{2}/.test(s)?s.replace(" ","T"):s+("start"===t?"T00:00:00":"T23:59:59.999"),a=new Date(r).getTime();return isNaN(a)?null:a}function v({isOpen:e,onClose:n,coupons:d,totalAmount:i,appliedCode:o,onApply:c}){const[u,m]=l.useState(""),x=Date.now(),p=l.useMemo(()=>{const e=d.map(e=>{const s=t(e.startsAt,"start"),r=t(e.expiresAt,"end"),a=(null==s||s<=x)&&(null==r||x<=r),n=null!=r&&x>r,l=null!=s&&x<s,d=!(null==(o=e.isActive)||("boolean"==typeof o?o:"number"==typeof o?0!==o:"string"!=typeof o||!/^(false|0|no|off)$/i.test(o.trim())));var o;const c=!d&&!n&&!l&&a,u=function(e,t){const s=Number(e.minOrderValue??0)||0,r=Number(t)||0;return s>0&&r<s?{eligible:!1,reason:`Add â‚¹${s-r} more to avail this offer`,addMore:s-r}:{eligible:!0}}(e,i),m=c&&u.eligible?function(e,t){const s=Number(t)||0,r=Number(e.discountValue)||0,a=null==e.maxDiscount?null:Number(e.maxDiscount)||0;if("amount"===e.discountType)return Math.max(0,Math.min(r,s));const n=r/100*s,l=null==a?n:Math.min(n,a);return Math.floor(l)}(e,i):0;return{c:e,active:c,elig:u,savings:m,expired:n,notStarted:l,inactive:d}}),s=e.filter(e=>e.active&&e.elig.eligible).sort((e,t)=>t.savings-e.savings);return{eligible:s,ineligible:e.filter(e=>!(e.active&&e.elig.eligible)),best:s[0]?.c.code||null}},[d,i,x]),g=({data:e})=>{const t="percentage"===e.c.discountType,r=t?"PERCENT OFF":"FLAT OFF",a=t?`Save ${e.c.discountValue}%${e.c.maxDiscount?` up to â‚¹${e.c.maxDiscount}`:""}`:`Get Flat â‚¹${e.c.discountValue} off`,l=t?`Use code ${e.c.code} & save ${e.c.discountValue}%${e.c.maxDiscount?` (max â‚¹${e.c.maxDiscount})`:""}${e.c.minOrderValue?` on orders above â‚¹${e.c.minOrderValue}`:""}`:`Use code ${e.c.code} & get â‚¹${e.c.discountValue} off${e.c.minOrderValue?` on orders above â‚¹${e.c.minOrderValue}`:""}`,d=!(e.active&&e.elig.eligible),i=p.best&&p.best===e.c.code;let u=o&&o===e.c.code?"APPLIED":"APPLY";return d&&(e.expired?u="EXPIRED":e.notStarted?u="SOON":e.inactive&&(u="UNAVAILABLE")),s.jsxs("div",{className:`relative overflow-hidden rounded-xl border ${d?"border-gray-200 opacity-70":"border-green-200"} bg-white`,children:[s.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-14 bg-gray-100 flex flex-col items-center justify-center text-[10px] tracking-wider text-gray-600",children:s.jsx("div",{className:"rotate-[-90deg] whitespace-nowrap",children:r})}),s.jsxs("div",{className:"pl-16 p-4",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-extrabold tracking-wide",children:e.c.code}),!e.elig.eligible&&e.elig.reason&&s.jsx("p",{className:"text-xs text-amber-700 mt-1",children:e.elig.reason}),e.elig.eligible&&s.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["You save â‚¹",e.savings]})]}),s.jsx("button",{disabled:d,onClick:()=>{c(e.c),n()},className:"text-sm font-semibold "+(d?"text-gray-400 cursor-not-allowed":"text-green-700 hover:text-green-800"),children:u})]}),s.jsx("p",{className:"text-sm text-gray-800 mt-2",children:a}),s.jsx("div",{className:"my-2 border-t border-dashed"}),s.jsx("p",{className:"text-xs text-gray-600",children:l}),d&&e.expired&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Coupon expired"}),e.c.description&&s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:e.c.description}),i&&s.jsx("span",{className:"inline-block mt-2 text-[10px] bg-green-100 text-green-800 px-2 py-0.5 rounded-full",children:"Best savings"})]})]})};return s.jsx(r,{children:e&&s.jsxs(a.div,{className:"fixed inset-0 z-40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[s.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:n}),s.jsxs(a.div,{className:"absolute inset-x-0 bottom-0 md:bottom-0 bg-gray-50 rounded-t-2xl shadow-2xl max-h-[calc(85vh-4rem)] md:max-h-[85vh] overflow-auto mb-16 md:mb-0",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:260,damping:28},children:[s.jsxs("div",{className:"p-4 border-b bg-white rounded-t-2xl",children:[s.jsx("div",{className:"h-1 w-10 bg-gray-200 rounded mx-auto mb-3"}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Apply Coupon"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["Your cart: â‚¹",i]})]}),s.jsx("button",{onClick:n,className:"text-sm text-gray-600 hover:text-gray-800",children:"Close"})]}),s.jsxs("div",{className:"mt-3 flex gap-2",children:[s.jsx("input",{value:u,onChange:e=>m(e.target.value.toUpperCase()),placeholder:"Enter coupon code",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),s.jsx("button",{onClick:()=>{const e=u.trim().toLowerCase(),t=p.eligible.find(t=>t.c.code.toLowerCase()===e);t&&(c(t.c),n())},className:"px-4 py-2 rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Apply"})]})]}),s.jsxs("div",{className:"p-4 space-y-3 pb-6",children:[p.eligible.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Eligible for you"}),p.eligible.map(e=>s.jsx(g,{data:e},e.c.code))]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"More offers"}),0===p.ineligible.length?s.jsx("p",{className:"text-xs text-gray-500",children:"No other offers."}):p.ineligible.map(e=>s.jsx(g,{data:e},e.c.code))]})]})]})]})})}e("CheckoutPage",function(){const{user:e,isAuthenticated:t,refreshProfile:r}=i(),{items:a,totalPrice:N,clearCart:w}=o();c(a.map(e=>e.product._id));const[A,C]=l.useState(!0),{Banner:k}=u({enabled:A,mutate:!1}),D=d(),P=f(),[O,S]=l.useState(""),[T,$]=l.useState(!1),[M,E]=l.useState(!1),[q,V]=l.useState(!1),[_,L]=l.useState(!1),[F,I]=l.useState([]),{show:U}=m();l.useEffect(()=>{if(window.innerWidth<768)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[]);const[K,R]=l.useState(null),[B,Y]=l.useState({address:e?.address||{houseNo:"",landmark:"",area:"",city:"Mysuru",state:"Karnataka",pincode:""},latitude:e?.latitude||0,longitude:e?.longitude||0,phone:e?.phone||""}),Q=l.useMemo(()=>e?.latitude&&e?.longitude?{lat:e.latitude,lon:e.longitude}:B.latitude&&B.longitude?{lat:B.latitude,lon:B.longitude}:null,[e?.latitude,e?.longitude,B.latitude,B.longitude]),{data:z}=j(["public","delivery-settings"],async()=>{try{const e=(await b()).data;if(!e)throw new Error("No data");const t=e.cities||[];return{enabled:e.enabled??!0,minOrderSubtotal:e.minOrderSubtotal??0,cities:t,updatedAt:e.updatedAt}}catch(e){return{enabled:!0,minOrderSubtotal:0,cities:[{name:"Mysuru",basePrice:50,pricePerKg:15,freeDeliveryThreshold:600},{name:"Bengaluru",basePrice:40,pricePerKg:10,freeDeliveryThreshold:500}]}}},{staleTime:3e5,cacheTime:6e5,refetchOnMount:"always"});l.useEffect(()=>{e&&Y(t=>({...t,address:e.address||{houseNo:"",landmark:"",area:"",city:"Mysuru",state:"Karnataka",pincode:""},latitude:t.latitude&&0!==t.latitude?t.latitude:e.latitude||0,longitude:t.longitude&&0!==t.longitude?t.longitude:e.longitude||0,phone:e.phone||""}))},[e,e?.address,e?.address?.city]),l.useEffect(()=>{0===a.length&&D("/cart",{replace:!0})},[a.length,D]);const{data:G=[]}=j({queryKey:["admin","coupons"],queryFn:async()=>{try{const e=(await h({page:1,limit:100})).data;let t=[];return Array.isArray(e)?t=e:e&&"object"==typeof e&&Array.isArray(e.data)&&(t=e.data||[]),t.map(e=>{const t=(e.code??e.couponCode??"").toString().toUpperCase();return t?{code:t,discountType:"percentage"===e.discountType||"amount"===e.discountType?e.discountType:"amount",discountValue:"number"==typeof e.discountValue?e.discountValue:0,minOrderValue:e.minOrderValue??null,maxDiscount:e.maxDiscount??null,startsAt:e.startsAt??null,expiresAt:e.expiresAt??null,isActive:e.isActive}:null}).filter(e=>!!e)}catch(e){const t=e?.response?.status;if(401===t||403===t)return[];throw e}},staleTime:3e5}),J=l.useMemo(()=>{if(!K)return 0;if("amount"===K.discountType)return Math.max(0,Math.min(K.discountValue,N));const e=K.discountValue/100*N,t=null==K.maxDiscount?e:Math.min(e,K.maxDiscount);return Math.floor(t)},[K,N]),W=Math.max(0,N-J),X=l.useMemo(()=>a.reduce((e,t)=>e+(t.product.g||0)/1e3*t.quantity,0),[a]),H=l.useMemo(()=>{const e=z;if(!e||!e.cities||0===e.cities.length)return 0;const t=(B.address.city||"").toLowerCase().trim();if(!t)return 0;const s=e.cities.find(e=>e.name.toLowerCase()===t);if(!s)return 0;if(s.freeDeliveryThreshold>0&&W>=s.freeDeliveryThreshold)return 0;const r=s.basePrice;if(X<=1)return r;const a=X-1;return r+Math.ceil(a)*s.pricePerKg},[z,B,W,X]),Z=Math.max(0,W+H),ee=(()=>{if(!z)return 0;const e=z.minOrderSubtotal||0;return Math.max(0,e-N)})(),te=async e=>{e.preventDefault();try{$(!0),S(""),C(!1);try{globalThis.__RECONCILE_PAUSED=!0}catch(s){}const e=String(B.phone||"").replace(/\D/g,"");if(!e||e.length<10)return S("Please enter a valid phone number."),void U("Please enter a valid phone number.",{type:"warning"});if(!B.address||[B.address.houseNo,B.address.area,B.address.landmark,B.address.city,B.address.state,B.address.pincode].every(e=>!e||0===e.trim().length))return S("Please enter your delivery address."),void U("Please enter your delivery address.",{type:"warning"});if(z?.enabled&&ee>0)return S(`Add â‚¹${ee} more to reach minimum order value.`),void U(`Add â‚¹${ee} more to reach minimum order value.`,{type:"warning"});let n;if(!t)return S("Please log in to place an order."),void D("/login");try{const e=[];if(await Promise.all(a.map(async t=>{try{const s=(await p(t.product._id)).data,r=Math.max(0,Number(s?.stock??t.product.stock??0)),a=t.quantity;(r<=0&&a>0||a>r)&&e.push({productId:t.product._id,requested:a,available:r,name:s?.name||t.product.name})}catch{}})),e.length>0){if(I(e),e.every(e=>e.available<=0)&&e.length===a.length)return S("All items appear out of stock. Please review your cart."),void U("All items appear out of stock. Please review your cart.",{type:"error"});U(`${e.length} item(s) may be reduced due to stock.`,{type:"warning"})}}catch{}try{const t=(await g({...B,phone:e,paymentMode:"COD",idempotencyKey:globalThis.crypto?.randomUUID?.()||`${Date.now()}_${Math.random()}`,couponCode:K?.code?.trim()?K.code.trim():void 0,items:a.map(e=>({productId:e.product._id,quantity:e.quantity}))})).data||{},s=t.order||t;n=s?._id||s?.id,await P.invalidateQueries({queryKey:["orders"]}),await P.refetchQueries({queryKey:["orders"],type:"active"}),Array.isArray(t.itemsOutOfStock)&&t.itemsOutOfStock.length>0?(I(t.itemsOutOfStock),U(`${t.itemsOutOfStock.length} item(s) removed due to stock.`,{type:"warning"})):U("Order placed successfully",{type:"success"})}catch(r){const t=r,s=t?.response?.status,l=t?.response?.data;if("number"==typeof s){if(400===s){const e=l?.reason;if("MIN_ORDER_NOT_MET"===e){const e=Number(l?.shortfall??0);S(`Add â‚¹${e} more to reach minimum order value.`),U(`Add â‚¹${e} more to reach minimum order value.`,{type:"warning"})}else{const e=l?.message||"Cart seems empty or invalid request.";S(e),U(e,{type:"error"})}return}return 401===s?(S("Your session expired. Please log in again."),U("Your session expired. Please log in again.",{type:"error"}),void D("/login")):404===s?(S(l?.message||"User not found. Please log in again."),U("User not found. Please log in again.",{type:"error"}),void D("/login")):409===s?(S(l?.message||"All items are out of stock."),void U("All items are out of stock.",{type:"error"})):(S(l?.message||"Error creating order. Please try again."),void U(l?.message||"Error creating order. Please try again.",{type:"error"}))}const d=localStorage.getItem("sakkat_orders"),i=d?JSON.parse(d):[],o=`local_${Date.now()}`,c={id:o,items:a.map(e=>({productId:e.product._id,quantity:e.quantity,price:e.product.price})),totalPrice:N,address:B.address,latitude:B.latitude,longitude:B.longitude,phone:e,createdAt:(new Date).toISOString(),paymentMode:"COD",status:"pending"};localStorage.setItem("sakkat_orders",JSON.stringify([c,...i])),n=o}if(!n)return;w(),D(`/orders/${n}`)}catch(r){S("Failed to place order. Please try again."),U("Failed to place order. Please try again.",{type:"error"})}finally{$(!1),C(!0);try{globalThis.__RECONCILE_PAUSED=!1}catch(s){}}};return 0===a.length?null:s.jsxs("div",{className:"md:min-h-screen bg-gradient-to-br from-green-50 via-amber-50 to-orange-50",children:[s.jsxs("div",{className:"hidden md:block max-w-7xl mx-auto px-4 py-6 md:py-8",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6 md:mb-8",children:[s.jsxs("button",{onClick:()=>D("/cart"),className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white border border-green-200 text-green-700 hover:bg-green-50 transition-all",children:[s.jsx("span",{className:"text-lg",children:"â†"}),s.jsx("span",{className:"text-sm font-medium",children:"Cart"})]}),s.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-green-900",children:"Checkout"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8",children:[s.jsxs("div",{className:"lg:col-span-2 order-1",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4 text-green-800",children:"Delivery Details"}),O&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded-2xl mb-6",children:O}),s.jsxs("form",{onSubmit:te,className:"bg-white rounded-2xl shadow-md border border-green-100 p-6 md:p-8 space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),s.jsx("input",{id:"phone",name:"phone",type:"tel",value:B.phone,onChange:e=>Y(t=>({...t,phone:e.target.value.replace(/\D/g,"").slice(0,10)})),inputMode:"numeric",maxLength:10,className:"w-full px-4 py-3 border border-green-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",placeholder:"Enter 10-digit mobile number",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"10-digit mobile number"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Address"}),s.jsx("textarea",{id:"address",name:"address",required:!0,value:[B.address.houseNo,B.address.area,B.address.landmark,B.address.city,B.address.state,B.address.pincode].filter(Boolean).join(", "),onChange:e=>{const{name:t,value:s}=e.target;Y(e=>({...e,[t]:s}))},rows:3,className:"w-full px-4 py-3 border border-green-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",readOnly:!0})]}),s.jsx("button",{type:"button",onClick:()=>L(!0),className:"w-full py-3 px-4 rounded-xl font-medium bg-blue-50 text-blue-800 hover:bg-blue-100 border border-blue-200 transition-all",children:"ðŸ“ Edit address"}),M&&s.jsx("p",{className:"text-sm text-green-700 bg-green-50 p-2 rounded-lg",children:"âœ“ Location confirmed"}),s.jsxs("div",{className:"border-t border-green-100 pt-6",children:[k,s.jsxs("button",{type:"button",onClick:()=>V(!0),className:"w-full text-left text-green-700 font-medium flex items-center justify-between bg-green-50 p-3 rounded-xl hover:bg-green-100 transition-all",children:[s.jsx("span",{className:"flex items-center gap-2",children:"ðŸŽŸï¸ Apply Coupon"}),!q&&s.jsx("span",{className:"transition-transform",children:"âŒ„"})]}),K&&s.jsxs("p",{className:"text-sm text-green-700 mt-2 bg-green-50 p-2 rounded-lg",children:["âœ“ Applied ",K.code,". You save â‚¹",J,"."]}),F.length>0&&s.jsxs("div",{className:"mt-3 bg-amber-50 border border-amber-200 text-amber-800 rounded-xl p-3 space-y-1",children:[s.jsx("p",{className:"text-sm font-medium",children:"âš ï¸ Removed due to stock:"}),s.jsxs("ul",{className:"list-disc list-inside text-sm",children:[F.slice(0,3).map((e,t)=>s.jsxs("li",{children:[e.name||e.productId," (",e.available??0,"/",e.requested??0,")"]},`${e.productId}-${t}`)),F.length>3&&s.jsxs("li",{children:["+",F.length-3," moreâ€¦"]})]})]})]}),s.jsxs("div",{className:"border-t border-green-100 pt-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-green-900",children:"Payment Method"}),s.jsx("div",{className:"flex items-center space-x-2 text-gray-700",children:s.jsx("span",{className:"bg-green-50 text-green-800 px-4 py-3 rounded-xl text-sm font-medium border border-green-200",children:"ðŸ’µ Cash on Delivery / UPI on Delivery"})})]}),ee>0&&s.jsxs("p",{className:"text-sm text-amber-700 bg-amber-50 p-3 rounded-xl border border-amber-200",children:["Add â‚¹",ee," more to reach minimum order value."]}),!B.address.city&&s.jsx("p",{className:"text-sm text-red-700 bg-red-50 p-3 rounded-xl border border-red-200",children:"Please select a delivery city to continue."}),s.jsx("button",{type:"submit",disabled:T||ee>0||!B.address.city,className:"hidden md:block w-full py-4 rounded-xl font-semibold transition-all "+(T||ee>0||!B.address.city?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg hover:shadow-xl"),children:T?"Placing Order...":"Place Order"+(K?` â€¢ â‚¹${Z}`:"")})]}),s.jsx(y,{isOpen:_,onClose:()=>L(!1),defaultCenter:Q,autoGeo:!0,showSaveCheckbox:!0,initialAddress:B.address,showMap:!1,onConfirm:async e=>{if(Y(t=>({...t,address:e.address,latitude:e.latitude,longitude:e.longitude})),E(!0),e.saveToProfile)try{await x({address:e.address,latitude:e.latitude,longitude:e.longitude}),await r(),U("Address saved to your profile",{type:"success"})}catch(t){U("Address updated for this order, but failed to save to profile",{type:"warning"})}}})]}),s.jsx("div",{className:"order-2",children:s.jsxs("div",{className:"lg:sticky lg:top-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4 text-green-800",children:"Order Summary"}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-md border border-green-100 p-6 md:p-8 space-y-4",children:[a.map(e=>{const t="number"==typeof e.product.g?e.product.g:0,r="number"==typeof e.product.pieces?e.product.pieces:0,a=t>0?t*e.quantity:0,l=a>0?n(a)||`${a} g`:null,d=r>0?r*e.quantity:0;return s.jsxs("div",{className:"flex justify-between items-start py-3 border-b border-green-50 last:border-0",children:[s.jsxs("div",{className:"min-w-0 pr-2",children:[s.jsx("p",{className:"font-semibold text-green-900 truncate",children:e.product.name}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",e.quantity]}),t>0&&s.jsxs("p",{className:"text-xs text-gray-500",children:["Each: ",n(t)||`${t} g`," â€¢ Total: ",l]}),r>0&&s.jsxs("p",{className:"text-xs text-gray-500",children:["Each: ",r," pcs â€¢ Total: ",d," pcs"]})]}),s.jsxs("p",{className:"font-semibold text-green-900 whitespace-nowrap",children:["â‚¹",e.product.price*e.quantity]})]},e.product._id)}),s.jsxs("div",{className:"border-t border-green-200 pt-4 mt-4 space-y-3",children:[s.jsxs("div",{className:"flex justify-between text-gray-700",children:[s.jsx("span",{children:"Subtotal"}),s.jsxs("span",{className:"font-medium",children:["â‚¹",N]})]}),K&&s.jsxs("div",{className:"flex justify-between text-green-700 bg-green-50 -mx-2 px-2 py-2 rounded-lg",children:[s.jsxs("span",{className:"font-medium",children:["ðŸŽ‰ Coupon (",K.code,")"]}),s.jsxs("span",{className:"font-semibold",children:["-â‚¹",J]})]}),s.jsxs("div",{className:"flex justify-between text-gray-700",children:[s.jsx("span",{children:"Delivery Fee"}),s.jsx("span",{className:"font-medium",children:0===H?"ðŸŽ Free":`â‚¹${H}`})]}),s.jsxs("div",{className:"flex justify-between text-lg pt-3 border-t border-green-200",children:[s.jsx("span",{className:"font-bold text-green-900",children:"Total Payable"}),s.jsxs("span",{className:"font-bold text-green-900",children:["â‚¹",Z]})]}),z&&z.enabled&&z.cities&&(()=>{const e=z,t=(B.address.city||"").toLowerCase(),r=e.cities.find(e=>e.name.toLowerCase()===t);return r?s.jsx("div",{className:"text-xs text-gray-600 bg-amber-50 p-2 rounded-lg",children:r.freeDeliveryThreshold>0&&W<r.freeDeliveryThreshold?s.jsxs("p",{children:[" Free delivery over â‚¹",r.freeDeliveryThreshold]}):null}):null})()]})]})]})})]})]}),s.jsxs("div",{className:"md:hidden fixed top-16 bottom-16 left-0 right-0 bg-white z-40 flex flex-col",children:[s.jsx("div",{className:"flex-shrink-0 bg-gradient-to-r from-green-50 to-amber-50 border-b-2 border-green-200 px-4 py-3 shadow-sm",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>D("/cart"),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-lg bg-white border border-green-200 text-green-700 hover:bg-green-50 transition-all",children:[s.jsx("span",{className:"text-base",children:"â†"}),s.jsx("span",{className:"text-xs font-medium",children:"Cart"})]}),s.jsx("h1",{className:"text-lg font-bold text-green-900",children:"Checkout"})]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-4 space-y-3",children:[s.jsx("h3",{className:"text-base font-bold text-blue-900 mb-2",children:"ðŸ“ Delivery Details"}),O&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded-lg text-xs",children:O}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Phone Number"}),s.jsx("input",{name:"phone",type:"tel",value:B.phone,onChange:e=>Y(t=>({...t,phone:e.target.value.replace(/\D/g,"").slice(0,10)})),inputMode:"numeric",maxLength:10,className:"w-full px-3 py-2.5 text-sm border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10-digit mobile number",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Delivery Address"}),s.jsx("div",{className:"text-xs text-gray-700 bg-white p-3 rounded-lg border border-blue-200 min-h-[3rem] leading-relaxed",children:[B.address.houseNo,B.address.area,B.address.landmark,B.address.city,B.address.state,B.address.pincode].filter(Boolean).join(", ")||"No address set"})]}),s.jsx("button",{type:"button",onClick:()=>L(!0),className:"w-full py-2.5 px-3 text-sm rounded-lg font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-200 transition-all",children:"ðŸ“ Edit Address"}),M&&s.jsx("p",{className:"text-xs text-green-700 bg-green-50 p-2 rounded-lg",children:"âœ“ Location confirmed"}),s.jsxs("button",{type:"button",onClick:()=>V(!0),className:"w-full text-left text-green-700 text-sm font-medium flex items-center justify-between bg-green-50 p-3 rounded-lg hover:bg-green-100 border border-green-200 transition-all",children:[s.jsx("span",{className:"flex items-center gap-2",children:"ðŸŽŸï¸ Apply Coupon"}),!q&&s.jsx("span",{className:"text-sm",children:"âŒ„"})]}),K&&s.jsxs("p",{className:"text-xs text-green-700 bg-green-50 p-2 rounded-lg",children:["âœ“ Applied ",K.code,". Save â‚¹",J]}),F.length>0&&s.jsxs("div",{className:"bg-amber-50 border border-amber-200 text-amber-800 rounded-lg p-3 text-xs",children:[s.jsx("p",{className:"font-medium",children:"âš ï¸ Stock issues:"}),s.jsxs("p",{className:"mt-1",children:[F.length," item(s) affected"]})]}),ee>0&&s.jsxs("p",{className:"text-xs text-amber-700 bg-amber-50 p-3 rounded-lg border border-amber-200",children:["Add â‚¹",ee," more for minimum order"]}),s.jsxs("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded-lg",children:[s.jsx("span",{className:"font-medium text-green-900",children:"ðŸ’µ Payment:"}),s.jsx("span",{className:"text-green-700 ml-1",children:"COD / UPI on Delivery"})]})]})]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-amber-50 rounded-2xl p-4 space-y-3",children:[s.jsx("h3",{className:"text-base font-bold text-green-900 mb-2",children:"ðŸ›’ Order Summary"}),s.jsx("div",{className:"space-y-2.5 max-h-36 overflow-y-auto",children:a.map(e=>{const t="number"==typeof e.product.g?e.product.g:0,r="number"==typeof e.product.pieces?e.product.pieces:0,a=t>0?t*e.quantity:0,l=a>0?n(a)||`${a} g`:null,d=r>0?r*e.quantity:0;return s.jsxs("div",{className:"flex justify-between items-start text-sm border-b border-green-100 pb-2 last:border-0",children:[s.jsxs("div",{className:"min-w-0 pr-2 flex-1",children:[s.jsx("p",{className:"font-semibold text-green-900 truncate text-sm",children:e.product.name}),s.jsxs("p",{className:"text-xs text-gray-600",children:["Qty: ",e.quantity]}),t>0&&s.jsxs("p",{className:"text-xs text-gray-500",children:[n(t)||`${t} g`," â€¢ ",l]}),r>0&&s.jsxs("p",{className:"text-xs text-gray-500",children:[r," pcs â€¢ ",d," pcs"]})]}),s.jsxs("p",{className:"font-semibold text-green-900 whitespace-nowrap text-sm",children:["â‚¹",e.product.price*e.quantity]})]},e.product._id)})}),s.jsxs("div",{className:"border-t border-green-200 pt-2.5 space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[s.jsx("span",{children:"Subtotal"}),s.jsxs("span",{className:"font-medium",children:["â‚¹",N]})]}),K&&s.jsxs("div",{className:"flex justify-between text-sm text-green-700 bg-green-100 -mx-1 px-2 py-1.5 rounded",children:[s.jsxs("span",{className:"font-medium",children:["ðŸŽ‰ ",K.code]}),s.jsxs("span",{className:"font-semibold",children:["-â‚¹",J]})]}),s.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[s.jsx("span",{children:"Delivery"}),s.jsx("span",{className:"font-medium",children:0===H?"ðŸŽ Free":`â‚¹${H}`})]}),s.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-green-300",children:[s.jsx("span",{className:"text-base font-bold text-green-900",children:"Total"}),s.jsxs("span",{className:"text-xl font-bold text-green-900",children:["â‚¹",Z]})]}),z&&z.enabled&&z.cities&&(()=>{const e=z,t=(B.address.city||"").toLowerCase(),r=e.cities.find(e=>e.name.toLowerCase()===t);return r&&r.freeDeliveryThreshold>0&&W<r.freeDeliveryThreshold?s.jsxs("p",{className:"text-xs text-amber-700 bg-amber-50 px-2 py-1.5 rounded",children:["Free delivery over â‚¹",r.freeDeliveryThreshold]}):null})(),!B.address.city&&s.jsx("p",{className:"text-xs text-red-700 bg-red-50 px-2 py-1.5 rounded mt-2",children:"Please select a delivery city"})]})]})]}),s.jsx("div",{className:"flex-shrink-0 border-t-2 border-green-200 bg-gradient-to-t from-white to-green-50 px-4 py-3 shadow-2xl",children:s.jsx("button",{type:"button",onClick:te,disabled:T||ee>0||!B.address.city,className:"w-full py-4 rounded-2xl font-bold text-base transition-all "+(T||ee>0||!B.address.city?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg active:scale-95"),children:T?"â³ Placing Order...":"ðŸ›’ Place Order"})})]}),s.jsx(v,{isOpen:q,onClose:()=>V(!1),coupons:G,totalAmount:N,appliedCode:K?.code||null,onApply:e=>{R({code:e.code,discountType:e.discountType,discountValue:e.discountValue,minOrderValue:e.minOrderValue??null,maxDiscount:e.maxDiscount??null,startsAt:e.startsAt??null,expiresAt:e.expiresAt??null,isActive:e.isActive})}})]})})}}});
