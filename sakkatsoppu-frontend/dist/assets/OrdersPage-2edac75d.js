import{j as e,A as t,m as s}from"./ui-vendor-090db037.js";import{r,b as a}from"./react-vendor-e826ac9a.js";import{d as n}from"./format-01d13a2f.js";import{b as i,n as l,a as o}from"./index-e944f7cc.js";import{c as d,E as c}from"./EmptyState-90642793.js";import{S as m}from"./Shimmer-954c7611.js";import{u}from"./data-vendor-7193eb6f.js";import{A as x}from"./ArrowLeftIcon-26eeecc0.js";import{M as p,S as h}from"./search-3268ebc4.js";function y({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const f=r.forwardRef(y),g=d("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);function b(){const{isAuthenticated:d}=i(),y=a(),[b,j]=r.useState("all"),[v,w]=r.useState(""),[N,A]=r.useState(!1),C=e=>{if(!e)return"pending";const t=String(e).trim().toLowerCase();return"canceled"===t?"cancelled":t.startsWith("deliver")?"delivered":t.startsWith("confirm")?"confirmed":t.startsWith("pend")?"pending":["pending","confirmed","delivered","cancelled"].includes(t)?t:"pending"},{data:S=[],isLoading:k}=u({queryKey:["orders"],queryFn:async()=>{const e=(await l()).data;return Array.isArray(e)?e:e&&"object"==typeof e&&Array.isArray(e.data)&&e.data||[]}}),{data:L=[]}=u({queryKey:["products","for-orders"],queryFn:async()=>{const e=await o({page:1,limit:500}),t=e=>{if(Array.isArray(e))return e;if(e&&"object"==typeof e){const s=e,r=["data","products","items","results","payload"];for(const e of r)if(e in s){const r=t(s[e]);if(Array.isArray(r))return r}const a=Object.values(s).find(Array.isArray);if(a)return t(a)}return[]};return t(e.data)},staleTime:6e4}),I=new Map;for(const e of L)if(e&&"object"==typeof e){const t=e,s="string"==typeof t._id?t._id:void 0,r="string"==typeof t.id?t.id:void 0;s&&I.set(s,e),r&&I.set(r,e)}let F=S;if(!d){const e=localStorage.getItem("sakkat_orders");F=e?JSON.parse(e):[]}const q=r.useMemo(()=>{let e=F;if("all"!==b&&(e=e.filter(e=>C(e.status)===b)),v.trim()){const t=v.toLowerCase();e=e.filter(e=>{if(C(e.status).toLowerCase().includes(t))return!0;return(e.items||[]).some(e=>{const s=e.productId,r=("object"==typeof e.product?e.product:void 0)||I.get(s);return(e.name||(null==r?void 0:r.name)||"").toLowerCase().includes(t)})})}return e},[F,b,v,I]),M=e=>{switch(e){case"delivered":return"bg-green-500 text-white";case"cancelled":return"bg-red-500 text-white";default:return"bg-yellow-400 text-gray-900"}},O=e=>{switch(e){case"delivered":return"Completed";case"pending":case"confirmed":return"In Process";case"cancelled":return"Cancelled";default:{const t=String(e||"");return t.charAt(0).toUpperCase()+t.slice(1)}}};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm flex-shrink-0",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>y("/"),className:"p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Go back to home",children:e.jsx(x,{className:"h-6 w-6 text-gray-700"})}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"My Order"})]})}),e.jsx("div",{className:"bg-gray-50 flex-shrink-0 border-b border-gray-200",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(p,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search here...",value:v,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-white rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsx("button",{onClick:()=>A(!N),className:"p-3 bg-white rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors","aria-label":"Toggle filter menu",children:e.jsx(f,{className:"h-5 w-5 text-gray-700"})})]}),e.jsx(t,{children:N&&e.jsxs(s.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 bg-white rounded-lg border border-gray-200 p-4 overflow-hidden",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Filter by Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","pending","confirmed","delivered","cancelled"].map(t=>e.jsx("button",{onClick:()=>{j(t),A(!1)},className:"px-4 py-2 rounded-full text-sm font-medium transition-colors ".concat(b===t?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"all"===t?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 pb-20 md:pb-4",children:[k&&0===F.length&&e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(m,{width:"w-32",height:"h-5"}),e.jsx(m,{width:"w-24",height:"h-4"})]}),e.jsx(m,{width:"w-20",height:"h-6",className:"rounded-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{width:"w-full",height:"h-4"}),e.jsx(m,{width:"w-2/3",height:"h-4"})]})]},t))}),0!==q.length||k?null:e.jsx("div",{children:F.length>0&&"all"!==b?e.jsx(c,{title:'No orders with status "'.concat(b,'"'),description:"Try switching the status filter to see other orders.",IconComponent:h}):e.jsx(c,{title:"No Orders Yet",description:"You haven't placed any orders yet. Start shopping to place your first order!",actionLabel:"Browse Products",actionTo:"/products",IconComponent:g})}),e.jsx("div",{className:"space-y-4",children:q.map((t,s)=>{var r,a;const i=C(t.status);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 border border-gray-100 animate-fade-in-scale",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:new Date(null!=(r=t.createdAt)?r:Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(()=>{const e=t.items||[];if(0===e.length)return"Order";const s=e[0],r=s.productId,a=("object"==typeof s.product?s.product:void 0)||I.get(r),n=s.name||(null==a?void 0:a.name)||"Items";return e.length>1?"".concat(n," +").concat(e.length-1," more"):n})()})]}),e.jsx("span",{className:"px-4 py-1.5 rounded-full text-xs font-semibold ".concat(M(i)),children:O(i)})]}),e.jsx("div",{className:"mb-3 space-y-2",children:(t.items||[]).map((t,s)=>{const r=t.productId,a=("object"==typeof t.product?t.product:void 0)||I.get(r),i=t.name||(null==a?void 0:a.name)||"Item",l="number"==typeof t.g?t.g:"number"==typeof(null==a?void 0:a.g)?a.g:0,o="number"==typeof t.pieces?t.pieces:"number"==typeof(null==a?void 0:a.pieces)?a.pieces:0,d=n({unitLabel:t.unitLabel||(null==a?void 0:a.unitLabel),g:l,pieces:o});return e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:i}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Qty: ",t.quantity,d?" • ".concat(d):""]})]}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["₹",(Number(t.price)||0)*Number(t.quantity||0)]})]},String(t.productId||t.id||s))})}),e.jsxs("div",{className:"border-t border-gray-100 pt-3 space-y-1.5 text-sm",children:["number"==typeof t.subtotalPrice&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",t.subtotalPrice]})]}),t.couponCode&&"number"==typeof t.discountAmount&&t.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:["Coupon (",t.couponCode,")"]}),e.jsxs("span",{children:["-₹",t.discountAmount]})]}),"number"==typeof t.deliveryFee&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{children:0===t.deliveryFee?"Free":"₹".concat(t.deliveryFee)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Amount"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["₹",null!=(a=t.totalPrice)?a:0]})]})]}),t.address&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Delivery Address"}),e.jsx("p",{className:"text-sm text-gray-700",children:t.address})]})]},t._id||t.id||s)})})]})})]})}export{b as OrdersPage};
