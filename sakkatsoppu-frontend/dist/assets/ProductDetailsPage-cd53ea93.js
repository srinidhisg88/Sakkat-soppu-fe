import{j as e}from"./ui-vendor-090db037.js";import{f as a,r as t,b as s,u as l}from"./react-vendor-e826ac9a.js";import{d as r,a as n,f as i}from"./format-01d13a2f.js";import{u as c,c as d,d as o,a as m,e as x,f as u}from"./index-3e3efc5f.js";import{u as g}from"./useAddToCartBar-ed7d9a08.js";import{u as h}from"./data-vendor-7193eb6f.js";function p(){var p,y,v,f,b,j,N;const{id:w}=a(),[k,C]=t.useState(1),{addToCart:q,updateQuantity:M,items:A}=c(),{isAuthenticated:F}=d(),{show:_}=o(),{showBar:I}=g(),L=s(),O=l(),{data:S,isLoading:E}=h({queryKey:["product",w],enabled:!!w,queryFn:async()=>(await x(w)).data});m([...(null==S?void 0:S._id)?[S._id]:[],...A.map(e=>e.product._id)]);const{data:P=[]}=h({queryKey:["categories","list"],queryFn:async()=>{var e,a;const t=(await u()).data;return Array.isArray(t)?t:null!=(a=null!=(e=null==t?void 0:t.data)?e:null==t?void 0:t.categories)?a:[]},staleTime:6e5}),T=t.useMemo(()=>{const e=new Set,a=a=>{a&&(Array.isArray(a)?a.forEach(a=>{const t="string"==typeof a?a:"";t&&e.add(t)}):"string"==typeof a&&e.add(a))};if(S){a(S.imageUrl),a(S.images);const e=S;a(e.image),a(e.imageURLs),a(e.imageUrls),a(e.gallery)}return Array.from(e)},[S]),[U,B]=t.useState(0),[K,R]=t.useState(null),D=t.useCallback(e=>0===T.length?0:Math.max(0,Math.min(T.length-1,e)),[T.length]),H=t.useCallback(()=>{B(e=>(e-1+T.length)%Math.max(1,T.length))},[T.length]),Q=t.useCallback(()=>{B(e=>(e+1)%Math.max(1,T.length))},[T.length]);t.useEffect(()=>{0!==T.length?U>=T.length&&B(0):0!==U&&B(0)},[T.length,U]),t.useEffect(()=>{let e=!1;if(!T||0===T.length)return R(1),()=>{e=!0};return(async()=>{const a=T.map(e=>new Promise(a=>{const t=new Image;t.onload=()=>{const e=t.naturalWidth||1,s=t.naturalHeight||1;a(s/e||1)},t.onerror=()=>a(1),t.src=e})),t=await Promise.all(a);if(!e){const e=Math.max(1,...t);R(Number.isFinite(e)?e:1)}})(),()=>{e=!0}},[T]);const V=T[D(U)]||(null==S?void 0:S.imageUrl)||"";if(E&&!S)return e.jsx("div",{className:"text-center py-8",children:"Loading product details..."});if(!S)return e.jsx("div",{className:"text-center py-8",children:"Product not found."});const W=(null==(p=A.find(e=>e.productId===S._id))?void 0:p.quantity)||0,z=Number(null!=(y=null==S?void 0:S.stock)?y:0),G=Math.max(0,z-W),J=W>0,X=S?r({unitLabel:S.unitLabel,g:null!=(v=S.g)?v:null,pieces:null!=(f=S.pieces)?f:null}):void 0,Y=S?n(S.price,{g:null!=(b=S.g)?b:null,unitLabel:null!=(j=S.unitLabel)?j:null}):void 0,Z=(null==S?void 0:S.category)&&S.category.trim()||(null==S?void 0:S.categoryId)&&(null==(N=P.find(e=>e._id===S.categoryId))?void 0:N.name)||(null==S?void 0:S.category);return e.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group w-full rounded-lg shadow-md bg-white overflow-hidden",style:{aspectRatio:null!=K?K:1},children:[e.jsx("img",{src:V,alt:S.name,className:"absolute inset-0 w-full h-full object-contain"}),T.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button","aria-label":"Previous image",onClick:H,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"‹"}),e.jsx("button",{type:"button","aria-label":"Next image",onClick:Q,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow hidden md:block",children:"›"})]})]}),T.length>1&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-5 lg:grid-cols-6 gap-2",children:T.map((a,t)=>{const s=t===U;return e.jsxs("button",{type:"button",onClick:()=>B(t),className:"relative w-full aspect-square rounded overflow-hidden ring-2 ".concat(s?"ring-green-500":"ring-transparent"),"aria-label":"Show image ".concat(t+1),children:[e.jsx("img",{src:a,alt:"".concat(S.name," ").concat(t+1),className:"w-full h-full object-cover"}),s&&e.jsx("span",{className:"absolute inset-0 ring-2 ring-green-500 rounded pointer-events-none"})]},t)})})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:S.name}),e.jsx("p",{className:"text-gray-600 mt-1 sm:mt-2",children:Z})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-xl sm:text-2xl font-bold",children:["₹",S.price]}),X&&e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 ml-2",children:["for ",X]}),Y&&e.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:Y})]}),S.isOrganic&&e.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Organic"})]}),e.jsx("div",{children:e.jsx("p",{className:"text-gray-700",children:S.description})}),e.jsx("div",{className:"space-y-1",children:z>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-800 font-medium",children:[z," packs available"]}),"number"==typeof S.g&&S.g>0&&(()=>{const a=i(S.g),t=z*S.g,s=i(t)||"".concat(t," g");return e.jsxs("p",{className:"text-sm text-gray-600",children:["Each pack: ",a," • Total ~",s]})})(),"number"==typeof S.pieces&&S.pieces>0&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Each pack: ",S.pieces," pcs • Total ",z*S.pieces," pcs"]}),z<=5&&e.jsxs("p",{className:"text-xs text-amber-700",children:["Only ",z," left"]})]}):e.jsx("p",{className:"text-red-600 font-medium",children:"Out of stock"})}),J?e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"In your cart"}),e.jsxs("div",{className:"flex items-center border rounded overflow-hidden",children:[e.jsx("button",{onClick:async()=>{try{await M(S._id,W-1)}catch(e){_("Failed to update quantity",{type:"error"})}},className:"px-4 py-2 text-gray-600 hover:bg-gray-100","aria-label":"Decrease quantity",children:"-"}),e.jsx("span",{className:"px-4 py-2 min-w-[3rem] text-center",children:W}),e.jsx("button",{onClick:async()=>{if(W+1>z)_("Cannot exceed available stock",{type:"warning"});else try{await M(S._id,W+1)}catch(e){_("Failed to update quantity",{type:"error"})}},className:"px-4 py-2 text-gray-600 hover:bg-gray-100","aria-label":"Increase quantity",children:"+"})]})]})}):e.jsxs(e.Fragment,{children:[G>0&&e.jsx("div",{className:"flex items-center space-x-3 sm:space-x-4",children:e.jsxs("div",{className:"flex items-center border rounded",children:[e.jsx("button",{onClick:()=>C(Math.max(1,k-1)),className:"px-3 sm:px-4 py-2 text-gray-600 hover:bg-gray-100 active:scale-95",children:"-"}),e.jsx("span",{className:"px-3 sm:px-4 py-2",children:k}),e.jsx("button",{onClick:()=>{G<=0?_("No more stock available for this item",{type:"warning"}):k>=G?(_("Cannot exceed available stock",{type:"warning"}),C(Math.max(1,G))):C(k+1)},className:"px-3 sm:px-4 py-2 text-gray-600 hover:bg-gray-100 active:scale-95",children:"+"})]})}),e.jsx("button",{onClick:async()=>{var e;if(S)if(F)try{const a=(null==(e=A.find(e=>e.productId===S._id))?void 0:e.quantity)||0,t=Math.max(0,(S.stock||0)-a);if(t<=0)return void _("No more stock available for this item",{type:"warning"});const s=Math.min(k,t);s<k&&_("Only ".concat(t," more pack(s) available. Added ").concat(s,"."),{type:"warning"}),await q(S._id,s),I(1)}catch(a){_("Failed to add to cart",{type:"error"})}else L("/login",{state:{from:O.pathname+O.search}})},disabled:G<=0,className:"w-full py-3 rounded-lg font-semibold ".concat(G>0?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:G>0?"Add":"Out of Stock"})]})]})]}),(S.videos||[]).length>0&&e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Product Videos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(S.videos||[]).map((a,t)=>e.jsx("div",{className:"aspect-w-16 aspect-h-9",children:e.jsx("video",{src:a,controls:!0,className:"w-full rounded-lg shadow"})},t))})]})]})}export{p as ProductDetailsPage};
