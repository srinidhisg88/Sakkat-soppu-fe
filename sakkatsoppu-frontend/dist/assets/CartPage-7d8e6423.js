import{j as e}from"./ui-vendor-090db037.js";import{b as s,L as r}from"./react-vendor-e826ac9a.js";import{u as t,d as a,a as l,h as c,i as d,j as n}from"./index-2c9ff40e.js";import{E as i}from"./EmptyState-1e8ab27c.js";import{f as o}from"./format-01d13a2f.js";import{u as m}from"./data-vendor-7193eb6f.js";function p(){const{items:p,totalPrice:x,updateQuantity:u,removeItem:h,loading:y}=t(),j=s(),{show:b}=a(),{data:g,isLoading:v}=m({queryKey:["public","delivery-settings"],queryFn:async()=>{var e,s,r,t;try{const a=(await n()).data;if(!a)throw new Error("No data");return{enabled:null==(e=a.enabled)||e,deliveryFee:null!=(s=a.deliveryFee)?s:0,freeDeliveryThreshold:null!=(r=a.freeDeliveryThreshold)?r:0,minOrderSubtotal:null!=(t=a.minOrderSubtotal)?t:0}}catch(a){return{enabled:!0,deliveryFee:0,freeDeliveryThreshold:0,minOrderSubtotal:0}}},staleTime:6e5});l(p.map(e=>e.product._id));const{Banner:f}=c({enabled:!0,mutate:!1}),{stocks:N}=d(),w=(()=>{var e;const s=g;if(!s||!s.enabled)return 0;const r=null!=(e=s.minOrderSubtotal)?e:0;return Math.max(0,r-x)})(),T=!v&&!!g&&g.enabled&&w>0;return y?e.jsx("div",{className:"text-center py-8",children:"Loading cart..."}):0===p.length?e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-8",children:e.jsx(i,{title:"Your Cart is Empty",description:"Browse our products and add some items to your cart.",actionLabel:"Browse Products",actionTo:"/products",icon:e.jsx("span",{children:"ðŸ§º"})})}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Shopping Cart"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:p.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:space-x-4 space-y-3 sm:space-y-0 bg-white p-4 rounded-lg shadow",children:[e.jsx("img",{src:s.product.imageUrl,alt:s.product.name,className:"w-full sm:w-24 h-40 sm:h-24 object-cover rounded"}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx(r,{to:"/products/".concat(s.product._id),className:"text-lg font-semibold hover:text-green-600",children:s.product.name}),e.jsx("p",{className:"text-gray-600",children:s.product.category}),e.jsxs("p",{className:"font-semibold mt-1",children:["â‚¹",s.product.price]}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 space-y-0.5",children:(()=>{const r=N.get(s.product._id),t="number"==typeof r?r:s.product.stock||0;return t>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[t," packs available"]}),"number"==typeof s.product.g&&s.product.g>0&&(()=>{const r=s.product.g,a=t*r,l=o(a)||"".concat(a," g");return e.jsxs("p",{children:["Each: ",o(r)||"".concat(r," g")," â€¢ Total ~",l]})})(),"number"==typeof s.product.pieces&&s.product.pieces>0&&e.jsxs("p",{children:["Each: ",s.product.pieces," pcs â€¢ Total ",t*s.product.pieces," pcs"]}),t<=5&&e.jsxs("p",{className:"text-amber-700",children:["Only ",t," left"]})]}):e.jsx("p",{className:"text-red-600",children:"Out of stock"})})()}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center border rounded",children:[e.jsx("button",{onClick:()=>u(s.product._id,Math.max(0,s.quantity-1)),className:"px-3 py-1 text-gray-600 hover:bg-gray-100",children:"-"}),e.jsx("span",{className:"px-3 py-1",children:s.quantity}),e.jsx("button",{onClick:()=>{const e=N.get(s.product._id),r="number"==typeof e?e:s.product.stock||0;r<=0?b("This item is currently out of stock",{type:"warning"}):s.quantity>=r?(b("Cannot exceed available stock",{type:"warning"}),u(s.product._id,r)):u(s.product._id,s.quantity+1)},className:"px-3 py-1 text-gray-600 hover:bg-gray-100",children:"+"})]}),e.jsx("button",{onClick:()=>h(s.product._id),className:"text-red-500 hover:text-red-600",children:"Remove"})]})]}),e.jsxs("p",{className:"text-lg font-semibold whitespace-nowrap",children:["â‚¹",s.product.price*s.quantity]})]},s.product._id))}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Order Summary"}),f,e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["â‚¹",x]})]}),v?e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{className:"inline-block h-4 w-12 bg-gray-200 rounded animate-pulse"})]}):g&&g.enabled?e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{children:g.freeDeliveryThreshold>0&&x>=g.freeDeliveryThreshold?"Free":g.deliveryFee>0?"â‚¹".concat(g.deliveryFee):"Free"})]}):null,e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total"}),v?e.jsx("span",{className:"inline-block h-5 w-16 bg-gray-200 rounded animate-pulse"}):e.jsxs("span",{children:["â‚¹",g&&g.enabled?g.freeDeliveryThreshold>0&&x>=g.freeDeliveryThreshold?x:x+(g.deliveryFee||0):x]})]})})]}),!v&&g&&g.enabled&&g.freeDeliveryThreshold>0&&x<g.freeDeliveryThreshold&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Free delivery over â‚¹",g.freeDeliveryThreshold]}),!v&&T&&e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Add â‚¹",w," more to reach minimum order value."]}),e.jsx("button",{onClick:()=>{T||j("/checkout")},disabled:T,"aria-disabled":T,className:"w-full py-3 rounded-lg font-semibold ".concat(T?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:"Proceed to Checkout"})]})})]})]})}export{p as CartPage};
