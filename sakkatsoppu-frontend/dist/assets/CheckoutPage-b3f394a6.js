import{j as e,A as t,m as r}from"./ui-vendor-090db037.js";import{f as s}from"./format-01d13a2f.js";import{r as a,b as n}from"./react-vendor-e826ac9a.js";import{b as l,u as d,d as o,h as i,c,k as u,e as m,l as x,j as p,m as g}from"./index-d47ee403.js";import{M as b}from"./MapAddressModal-64cdcc18.js";import{c as h,u as y}from"./data-vendor-7193eb6f.js";import"./map-vendor-da2eca32.js";function f(e,t="start"){if(null==e)return null;if("number"==typeof e){const t=e>1e12?e:1e3*e;return Number.isFinite(t)?t:null}const r=String(e).trim();if(!r)return null;if(/^\d{10,13}$/.test(r)){const e=Number(r.length<=10?1e3*Number(r):Number(r));return Number.isFinite(e)?e:null}const s=/[T\s]\d{1,2}:\d{2}/.test(r)?r.replace(" ","T"):r+("start"===t?"T00:00:00":"T23:59:59.999"),a=new Date(s).getTime();return isNaN(a)?null:a}function v({isOpen:s,onClose:n,coupons:l,totalAmount:d,appliedCode:o,onApply:i}){const[c,u]=a.useState(""),m=Date.now(),x=a.useMemo(()=>{var e;const t=l.map(e=>{const t=f(e.startsAt,"start"),r=f(e.expiresAt,"end"),s=(null==t||t<=m)&&(null==r||m<=r),a=null!=r&&m>r,n=null!=t&&m<t,l=!(null==(o=e.isActive)||("boolean"==typeof o?o:"number"==typeof o?0!==o:"string"!=typeof o||!/^(false|0|no|off)$/i.test(o.trim())));var o;const i=!l&&!a&&!n&&s,c=function(e,t){var r;const s=Number(null!=(r=e.minOrderValue)?r:0)||0,a=Number(t)||0;return s>0&&a<s?{eligible:!1,reason:"Add â‚¹".concat(s-a," more to avail this offer"),addMore:s-a}:{eligible:!0}}(e,d),u=i&&c.eligible?function(e,t){const r=Number(t)||0,s=Number(e.discountValue)||0,a=null==e.maxDiscount?null:Number(e.maxDiscount)||0;if("amount"===e.discountType)return Math.max(0,Math.min(s,r));const n=s/100*r,l=null==a?n:Math.min(n,a);return Math.floor(l)}(e,d):0;return{c:e,active:i,elig:c,savings:u,expired:a,notStarted:n,inactive:l}}),r=t.filter(e=>e.active&&e.elig.eligible).sort((e,t)=>t.savings-e.savings);return{eligible:r,ineligible:t.filter(e=>!(e.active&&e.elig.eligible)),best:(null==(e=r[0])?void 0:e.c.code)||null}},[l,d,m]),p=({data:t})=>{const r="percentage"===t.c.discountType,s=r?"PERCENT OFF":"FLAT OFF",a=r?"Save ".concat(t.c.discountValue,"%").concat(t.c.maxDiscount?" up to â‚¹".concat(t.c.maxDiscount):""):"Get Flat â‚¹".concat(t.c.discountValue," off"),l=r?"Use code ".concat(t.c.code," & save ").concat(t.c.discountValue,"%").concat(t.c.maxDiscount?" (max â‚¹".concat(t.c.maxDiscount,")"):"").concat(t.c.minOrderValue?" on orders above â‚¹".concat(t.c.minOrderValue):""):"Use code ".concat(t.c.code," & get â‚¹").concat(t.c.discountValue," off").concat(t.c.minOrderValue?" on orders above â‚¹".concat(t.c.minOrderValue):""),d=!(t.active&&t.elig.eligible),c=x.best&&x.best===t.c.code;let u=o&&o===t.c.code?"APPLIED":"APPLY";return d&&(t.expired?u="EXPIRED":t.notStarted?u="SOON":t.inactive&&(u="UNAVAILABLE")),e.jsxs("div",{className:"relative overflow-hidden rounded-xl border ".concat(d?"border-gray-200 opacity-70":"border-green-200"," bg-white"),children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-14 bg-gray-100 flex flex-col items-center justify-center text-[10px] tracking-wider text-gray-600",children:e.jsx("div",{className:"rotate-[-90deg] whitespace-nowrap",children:s})}),e.jsxs("div",{className:"pl-16 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-extrabold tracking-wide",children:t.c.code}),!t.elig.eligible&&t.elig.reason&&e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:t.elig.reason}),t.elig.eligible&&e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["You save â‚¹",t.savings]})]}),e.jsx("button",{disabled:d,onClick:()=>{i(t.c),n()},className:"text-sm font-semibold ".concat(d?"text-gray-400 cursor-not-allowed":"text-green-700 hover:text-green-800"),children:u})]}),e.jsx("p",{className:"text-sm text-gray-800 mt-2",children:a}),e.jsx("div",{className:"my-2 border-t border-dashed"}),e.jsx("p",{className:"text-xs text-gray-600",children:l}),d&&t.expired&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Coupon expired"}),t.c.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.c.description}),c&&e.jsx("span",{className:"inline-block mt-2 text-[10px] bg-green-100 text-green-800 px-2 py-0.5 rounded-full",children:"Best savings"})]})]})};return e.jsx(t,{children:s&&e.jsxs(r.div,{className:"fixed inset-0 z-40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:n}),e.jsxs(r.div,{className:"absolute inset-x-0 bottom-0 md:bottom-0 bg-gray-50 rounded-t-2xl shadow-2xl max-h-[calc(85vh-4rem)] md:max-h-[85vh] overflow-auto mb-16 md:mb-0",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:260,damping:28},children:[e.jsxs("div",{className:"p-4 border-b bg-white rounded-t-2xl",children:[e.jsx("div",{className:"h-1 w-10 bg-gray-200 rounded mx-auto mb-3"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Apply Coupon"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Your cart: â‚¹",d]})]}),e.jsx("button",{onClick:n,className:"text-sm text-gray-600 hover:text-gray-800",children:"Close"})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{value:c,onChange:e=>u(e.target.value.toUpperCase()),placeholder:"Enter coupon code",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsx("button",{onClick:()=>{const e=c.trim().toLowerCase(),t=x.eligible.find(t=>t.c.code.toLowerCase()===e);t&&(i(t.c),n())},className:"px-4 py-2 rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Apply"})]})]}),e.jsxs("div",{className:"p-4 space-y-3 pb-6",children:[x.eligible.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Eligible for you"}),x.eligible.map(t=>e.jsx(p,{data:t},t.c.code))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"More offers"}),0===x.ineligible.length?e.jsx("p",{className:"text-xs text-gray-500",children:"No other offers."}):x.ineligible.map(t=>e.jsx(p,{data:t},t.c.code))]})]})]})]})})}function j(){var t;const{user:r,isAuthenticated:f,refreshProfile:j}=l(),{items:N,totalPrice:w,clearCart:A}=d();o(N.map(e=>e.product._id));const[C,k]=a.useState(!0),{Banner:D}=i({enabled:C,mutate:!1}),O=n(),P=h(),[S,T]=a.useState(""),[M,E]=a.useState(!1),[q,V]=a.useState(!1),[_,L]=a.useState(!1),[F,I]=a.useState(!1),[U,K]=a.useState([]),{show:R}=c();a.useEffect(()=>{if(window.innerWidth<768)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[]);const[B,Y]=a.useState(null),[Q,z]=a.useState({address:(null==r?void 0:r.address)||{houseNo:"",landmark:"",area:"",city:"Mysuru",state:"Karnataka",pincode:""},latitude:(null==r?void 0:r.latitude)||0,longitude:(null==r?void 0:r.longitude)||0,phone:(null==r?void 0:r.phone)||""}),G=a.useMemo(()=>(null==r?void 0:r.latitude)&&(null==r?void 0:r.longitude)?{lat:r.latitude,lon:r.longitude}:Q.latitude&&Q.longitude?{lat:Q.latitude,lon:Q.longitude}:null,[null==r?void 0:r.latitude,null==r?void 0:r.longitude,Q.latitude,Q.longitude]),{data:J}=y(["public","delivery-settings"],async()=>{var e,t;try{const r=(await p()).data;if(!r)throw new Error("No data");const s=r.cities||[];return{enabled:null==(e=r.enabled)||e,minOrderSubtotal:null!=(t=r.minOrderSubtotal)?t:0,cities:s,updatedAt:r.updatedAt}}catch(r){return{enabled:!0,minOrderSubtotal:0,cities:[{name:"Mysuru",basePrice:50,pricePerKg:15,freeDeliveryThreshold:600},{name:"Bengaluru",basePrice:40,pricePerKg:10,freeDeliveryThreshold:500}]}}},{staleTime:3e5,cacheTime:6e5,refetchOnMount:"always"});a.useEffect(()=>{r&&z(e=>({...e,address:r.address||{houseNo:"",landmark:"",area:"",city:"Mysuru",state:"Karnataka",pincode:""},latitude:e.latitude&&0!==e.latitude?e.latitude:r.latitude||0,longitude:e.longitude&&0!==e.longitude?e.longitude:r.longitude||0,phone:r.phone||""}))},[r,null==r?void 0:r.address,null==(t=null==r?void 0:r.address)?void 0:t.city]),a.useEffect(()=>{0===N.length&&O("/cart",{replace:!0})},[N.length,O]);const{data:$=[]}=y({queryKey:["admin","coupons"],queryFn:async()=>{var e;try{const e=(await g({page:1,limit:100})).data;let t=[];Array.isArray(e)?t=e:e&&"object"==typeof e&&Array.isArray(e.data)&&(t=e.data||[]);return t.map(e=>{var t,r,s,a,n,l;const d=(null!=(r=null!=(t=e.code)?t:e.couponCode)?r:"").toString().toUpperCase();if(!d)return null;return{code:d,discountType:"percentage"===e.discountType||"amount"===e.discountType?e.discountType:"amount",discountValue:"number"==typeof e.discountValue?e.discountValue:0,minOrderValue:null!=(s=e.minOrderValue)?s:null,maxDiscount:null!=(a=e.maxDiscount)?a:null,startsAt:null!=(n=e.startsAt)?n:null,expiresAt:null!=(l=e.expiresAt)?l:null,isActive:e.isActive}}).filter(e=>!!e)}catch(t){const r=null==(e=null==t?void 0:t.response)?void 0:e.status;if(401===r||403===r)return[];throw t}},staleTime:3e5}),W=a.useMemo(()=>{if(!B)return 0;if("amount"===B.discountType)return Math.max(0,Math.min(B.discountValue,w));const e=B.discountValue/100*w,t=null==B.maxDiscount?e:Math.min(e,B.maxDiscount);return Math.floor(t)},[B,w]),X=Math.max(0,w-W),H=a.useMemo(()=>N.reduce((e,t)=>e+(t.product.g||0)/1e3*t.quantity,0),[N]),Z=a.useMemo(()=>{const e=J;if(!e||!e.cities||0===e.cities.length)return 0;let t=(Q.address.city||"").toLowerCase().trim();if(!t)return 0;const r={mysore:"mysuru",bangalore:"bengaluru"};r[t]&&(t=r[t]);const s=e.cities.find(e=>e.name.toLowerCase()===t);if(!s)return 0;if(s.freeDeliveryThreshold>0&&X>=s.freeDeliveryThreshold)return 0;const a=s.basePrice;if(H<=1)return a;const n=H-1;return a+Math.ceil(n)*s.pricePerKg},[J,Q,X,H]),ee=Math.max(0,X+Z),te=(()=>{if(!J)return 0;const e=J.minOrderSubtotal||0;return Math.max(0,e-w)})(),re=async e=>{var t,r,s,a,n,l;e.preventDefault();try{E(!0),T(""),k(!1);try{globalThis.__RECONCILE_PAUSED=!0}catch(d){0}const e=String(Q.phone||"").replace(/\D/g,"");if(!e||e.length<10)return T("Please enter a valid phone number."),void R("Please enter a valid phone number.",{type:"warning"});if(!Q.address||[Q.address.houseNo,Q.address.area,Q.address.landmark,Q.address.city,Q.address.state,Q.address.pincode].every(e=>!e||0===e.trim().length))return T("Please enter your delivery address."),void R("Please enter your delivery address.",{type:"warning"});if((null==J?void 0:J.enabled)&&te>0)return T("Add â‚¹".concat(te," more to reach minimum order value.")),void R("Add â‚¹".concat(te," more to reach minimum order value."),{type:"warning"});let i;if(!f)return T("Please log in to place an order."),void O("/login");try{const e=[];if(await Promise.all(N.map(async t=>{var r,s;try{const a=(await m(t.product._id)).data,n=Math.max(0,Number(null!=(s=null!=(r=null==a?void 0:a.stock)?r:t.product.stock)?s:0)),l=t.quantity;(n<=0&&l>0||l>n)&&e.push({productId:t.product._id,requested:l,available:n,name:(null==a?void 0:a.name)||t.product.name})}catch(d){}})),e.length>0){K(e);if(e.every(e=>e.available<=0)&&e.length===N.length)return T("All items appear out of stock. Please review your cart."),void R("All items appear out of stock. Please review your cart.",{type:"error"});R("".concat(e.length," item(s) may be reduced due to stock."),{type:"warning"})}}catch(d){}try{const a=(await x({...Q,phone:e,paymentMode:"COD",idempotencyKey:(null==(r=null==(t=globalThis.crypto)?void 0:t.randomUUID)?void 0:r.call(t))||"".concat(Date.now(),"_").concat(Math.random()),couponCode:(null==(s=null==B?void 0:B.code)?void 0:s.trim())?B.code.trim():void 0,items:N.map(e=>({productId:e.product._id,quantity:e.quantity}))})).data||{},n=a.order||a;i=(null==n?void 0:n._id)||(null==n?void 0:n.id),await P.invalidateQueries({queryKey:["orders"]}),await P.refetchQueries({queryKey:["orders"],type:"active"}),Array.isArray(a.itemsOutOfStock)&&a.itemsOutOfStock.length>0?(K(a.itemsOutOfStock),R("".concat(a.itemsOutOfStock.length," item(s) removed due to stock."),{type:"warning"})):R("Order placed successfully",{type:"success"})}catch(o){const t=o,r=null==(a=null==t?void 0:t.response)?void 0:a.status,s=null==(n=null==t?void 0:t.response)?void 0:n.data;if("number"==typeof r){if(400===r){if("MIN_ORDER_NOT_MET"===(null==s?void 0:s.reason)){const e=Number(null!=(l=null==s?void 0:s.shortfall)?l:0);T("Add â‚¹".concat(e," more to reach minimum order value.")),R("Add â‚¹".concat(e," more to reach minimum order value."),{type:"warning"})}else{const e=(null==s?void 0:s.message)||"Cart seems empty or invalid request.";T(e),R(e,{type:"error"})}return}return 401===r?(T("Your session expired. Please log in again."),R("Your session expired. Please log in again.",{type:"error"}),void O("/login")):404===r?(T((null==s?void 0:s.message)||"User not found. Please log in again."),R("User not found. Please log in again.",{type:"error"}),void O("/login")):409===r?(T((null==s?void 0:s.message)||"All items are out of stock."),void R("All items are out of stock.",{type:"error"})):(T((null==s?void 0:s.message)||"Error creating order. Please try again."),void R((null==s?void 0:s.message)||"Error creating order. Please try again.",{type:"error"}))}const d=localStorage.getItem("sakkat_orders"),c=d?JSON.parse(d):[],u="local_".concat(Date.now()),m={id:u,items:N.map(e=>({productId:e.product._id,quantity:e.quantity,price:e.product.price})),totalPrice:w,address:Q.address,latitude:Q.latitude,longitude:Q.longitude,phone:e,createdAt:(new Date).toISOString(),paymentMode:"COD",status:"pending"};localStorage.setItem("sakkat_orders",JSON.stringify([m,...c])),i=u}if(!i)return;A(),O("/orders/".concat(i))}catch(o){T("Failed to place order. Please try again."),R("Failed to place order. Please try again.",{type:"error"})}finally{E(!1),k(!0);try{globalThis.__RECONCILE_PAUSED=!1}catch(d){}}};return 0===N.length?null:e.jsxs("div",{className:"md:min-h-screen bg-gradient-to-br from-green-50 via-amber-50 to-orange-50",children:[e.jsxs("div",{className:"hidden md:block max-w-7xl mx-auto px-4 py-6 md:py-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 md:mb-8",children:[e.jsxs("button",{onClick:()=>O("/cart"),className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white border border-green-200 text-green-700 hover:bg-green-50 transition-all",children:[e.jsx("span",{className:"text-lg",children:"â†"}),e.jsx("span",{className:"text-sm font-medium",children:"Cart"})]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-green-900",children:"Checkout"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 order-1",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-green-800",children:"Delivery Details"}),S&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded-2xl mb-6",children:S}),e.jsxs("form",{onSubmit:re,className:"bg-white rounded-2xl shadow-md border border-green-100 p-6 md:p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:Q.phone,onChange:e=>z(t=>({...t,phone:e.target.value.replace(/\D/g,"").slice(0,10)})),inputMode:"numeric",maxLength:10,className:"w-full px-4 py-3 border border-green-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",placeholder:"Enter 10-digit mobile number",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"10-digit mobile number"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Address"}),e.jsx("textarea",{id:"address",name:"address",required:!0,value:[Q.address.houseNo,Q.address.area,Q.address.landmark,Q.address.city,Q.address.state,Q.address.pincode].filter(Boolean).join(", "),onChange:e=>{const{name:t,value:r}=e.target;z(e=>({...e,[t]:r}))},rows:3,className:"w-full px-4 py-3 border border-green-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",readOnly:!0})]}),e.jsx("button",{type:"button",onClick:()=>I(!0),className:"w-full py-3 px-4 rounded-xl font-medium bg-blue-50 text-blue-800 hover:bg-blue-100 border border-blue-200 transition-all",children:"ðŸ“ Edit address"}),q&&e.jsx("p",{className:"text-sm text-green-700 bg-green-50 p-2 rounded-lg",children:"âœ“ Location confirmed"}),e.jsxs("div",{className:"border-t border-green-100 pt-6",children:[D,e.jsxs("button",{type:"button",onClick:()=>L(!0),className:"w-full text-left text-green-700 font-medium flex items-center justify-between bg-green-50 p-3 rounded-xl hover:bg-green-100 transition-all",children:[e.jsx("span",{className:"flex items-center gap-2",children:"ðŸŽŸï¸ Apply Coupon"}),!_&&e.jsx("span",{className:"transition-transform",children:"âŒ„"})]}),B&&e.jsxs("p",{className:"text-sm text-green-700 mt-2 bg-green-50 p-2 rounded-lg",children:["âœ“ Applied ",B.code,". You save â‚¹",W,"."]}),U.length>0&&e.jsxs("div",{className:"mt-3 bg-amber-50 border border-amber-200 text-amber-800 rounded-xl p-3 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"âš ï¸ Removed due to stock:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm",children:[U.slice(0,3).map((t,r)=>{var s,a;return e.jsxs("li",{children:[t.name||t.productId," (",null!=(s=t.available)?s:0,"/",null!=(a=t.requested)?a:0,")"]},"".concat(t.productId,"-").concat(r))}),U.length>3&&e.jsxs("li",{children:["+",U.length-3," moreâ€¦"]})]})]})]}),e.jsxs("div",{className:"border-t border-green-100 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-green-900",children:"Payment Method"}),e.jsx("div",{className:"flex items-center space-x-2 text-gray-700",children:e.jsx("span",{className:"bg-green-50 text-green-800 px-4 py-3 rounded-xl text-sm font-medium border border-green-200",children:"ðŸ’µ Cash on Delivery / UPI on Delivery"})})]}),te>0&&e.jsxs("p",{className:"text-sm text-amber-700 bg-amber-50 p-3 rounded-xl border border-amber-200",children:["Add â‚¹",te," more to reach minimum order value."]}),!Q.address.city&&e.jsx("p",{className:"text-sm text-red-700 bg-red-50 p-3 rounded-xl border border-red-200",children:"Please select a delivery city to continue."}),e.jsx("button",{type:"submit",disabled:M||te>0||!Q.address.city,className:"hidden md:block w-full py-4 rounded-xl font-semibold transition-all ".concat(M||te>0||!Q.address.city?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg hover:shadow-xl"),children:M?"Placing Order...":"Place Order".concat(B?" â€¢ â‚¹".concat(ee):"")})]}),e.jsx(b,{isOpen:F,onClose:()=>I(!1),defaultCenter:G,autoGeo:!0,showSaveCheckbox:!0,initialAddress:Q.address,showMap:!1,onConfirm:async e=>{if(z(t=>({...t,address:e.address,latitude:e.latitude,longitude:e.longitude})),V(!0),e.saveToProfile)try{await u({address:e.address,latitude:e.latitude,longitude:e.longitude}),await j(),R("Address saved to your profile",{type:"success"})}catch(t){R("Address updated for this order, but failed to save to profile",{type:"warning"})}}})]}),e.jsx("div",{className:"order-2",children:e.jsxs("div",{className:"lg:sticky lg:top-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-green-800",children:"Order Summary"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md border border-green-100 p-6 md:p-8 space-y-4",children:[N.map(t=>{const r="number"==typeof t.product.g?t.product.g:0,a="number"==typeof t.product.pieces?t.product.pieces:0,n=r>0?r*t.quantity:0,l=n>0?s(n)||"".concat(n," g"):null,d=a>0?a*t.quantity:0;return e.jsxs("div",{className:"flex justify-between items-start py-3 border-b border-green-50 last:border-0",children:[e.jsxs("div",{className:"min-w-0 pr-2",children:[e.jsx("p",{className:"font-semibold text-green-900 truncate",children:t.product.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",t.quantity]}),r>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Each: ",s(r)||"".concat(r," g")," â€¢ Total: ",l]}),a>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Each: ",a," pcs â€¢ Total: ",d," pcs"]})]}),e.jsxs("p",{className:"font-semibold text-green-900 whitespace-nowrap",children:["â‚¹",t.product.price*t.quantity]})]},t.product._id)}),e.jsxs("div",{className:"border-t border-green-200 pt-4 mt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["â‚¹",w]})]}),B&&e.jsxs("div",{className:"flex justify-between text-green-700 bg-green-50 -mx-2 px-2 py-2 rounded-lg",children:[e.jsxs("span",{className:"font-medium",children:["ðŸŽ‰ Coupon (",B.code,")"]}),e.jsxs("span",{className:"font-semibold",children:["-â‚¹",W]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{className:"font-medium",children:0===Z?"ðŸŽ Free":"â‚¹".concat(Z)})]}),e.jsxs("div",{className:"flex justify-between text-lg pt-3 border-t border-green-200",children:[e.jsx("span",{className:"font-bold text-green-900",children:"Total Payable"}),e.jsxs("span",{className:"font-bold text-green-900",children:["â‚¹",ee]})]}),J&&J.enabled&&J.cities&&(()=>{const t=J,r=(Q.address.city||"").toLowerCase(),s=t.cities.find(e=>e.name.toLowerCase()===r);return s?e.jsx("div",{className:"text-xs text-gray-600 bg-amber-50 p-2 rounded-lg",children:s.freeDeliveryThreshold>0&&X<s.freeDeliveryThreshold?e.jsxs("p",{children:[" Free delivery over â‚¹",s.freeDeliveryThreshold]}):null}):null})()]})]})]})})]})]}),e.jsxs("div",{className:"md:hidden fixed top-16 bottom-16 left-0 right-0 bg-white z-40 flex flex-col",children:[e.jsx("div",{className:"flex-shrink-0 bg-gradient-to-r from-green-50 to-amber-50 border-b-2 border-green-200 px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>O("/cart"),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-lg bg-white border border-green-200 text-green-700 hover:bg-green-50 transition-all",children:[e.jsx("span",{className:"text-base",children:"â†"}),e.jsx("span",{className:"text-xs font-medium",children:"Cart"})]}),e.jsx("h1",{className:"text-lg font-bold text-green-900",children:"Checkout"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-4 space-y-3",children:[e.jsx("h3",{className:"text-base font-bold text-blue-900 mb-2",children:"ðŸ“ Delivery Details"}),S&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded-lg text-xs",children:S}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Phone Number"}),e.jsx("input",{name:"phone",type:"tel",value:Q.phone,onChange:e=>z(t=>({...t,phone:e.target.value.replace(/\D/g,"").slice(0,10)})),inputMode:"numeric",maxLength:10,className:"w-full px-3 py-2.5 text-sm border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10-digit mobile number",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Delivery Address"}),e.jsx("div",{className:"text-xs text-gray-700 bg-white p-3 rounded-lg border border-blue-200 min-h-[3rem] leading-relaxed",children:[Q.address.houseNo,Q.address.area,Q.address.landmark,Q.address.city,Q.address.state,Q.address.pincode].filter(Boolean).join(", ")||"No address set"})]}),e.jsx("button",{type:"button",onClick:()=>I(!0),className:"w-full py-2.5 px-3 text-sm rounded-lg font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-200 transition-all",children:"ðŸ“ Edit Address"}),q&&e.jsx("p",{className:"text-xs text-green-700 bg-green-50 p-2 rounded-lg",children:"âœ“ Location confirmed"}),e.jsxs("button",{type:"button",onClick:()=>L(!0),className:"w-full text-left text-green-700 text-sm font-medium flex items-center justify-between bg-green-50 p-3 rounded-lg hover:bg-green-100 border border-green-200 transition-all",children:[e.jsx("span",{className:"flex items-center gap-2",children:"ðŸŽŸï¸ Apply Coupon"}),!_&&e.jsx("span",{className:"text-sm",children:"âŒ„"})]}),B&&e.jsxs("p",{className:"text-xs text-green-700 bg-green-50 p-2 rounded-lg",children:["âœ“ Applied ",B.code,". Save â‚¹",W]}),U.length>0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 text-amber-800 rounded-lg p-3 text-xs",children:[e.jsx("p",{className:"font-medium",children:"âš ï¸ Stock issues:"}),e.jsxs("p",{className:"mt-1",children:[U.length," item(s) affected"]})]}),te>0&&e.jsxs("p",{className:"text-xs text-amber-700 bg-amber-50 p-3 rounded-lg border border-amber-200",children:["Add â‚¹",te," more for minimum order"]}),e.jsxs("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded-lg",children:[e.jsx("span",{className:"font-medium text-green-900",children:"ðŸ’µ Payment:"}),e.jsx("span",{className:"text-green-700 ml-1",children:"COD / UPI on Delivery"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-amber-50 rounded-2xl p-4 space-y-3",children:[e.jsx("h3",{className:"text-base font-bold text-green-900 mb-2",children:"ðŸ›’ Order Summary"}),e.jsx("div",{className:"space-y-2.5 max-h-36 overflow-y-auto",children:N.map(t=>{const r="number"==typeof t.product.g?t.product.g:0,a="number"==typeof t.product.pieces?t.product.pieces:0,n=r>0?r*t.quantity:0,l=n>0?s(n)||"".concat(n," g"):null,d=a>0?a*t.quantity:0;return e.jsxs("div",{className:"flex justify-between items-start text-sm border-b border-green-100 pb-2 last:border-0",children:[e.jsxs("div",{className:"min-w-0 pr-2 flex-1",children:[e.jsx("p",{className:"font-semibold text-green-900 truncate text-sm",children:t.product.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Qty: ",t.quantity]}),r>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:[s(r)||"".concat(r," g")," â€¢ ",l]}),a>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:[a," pcs â€¢ ",d," pcs"]})]}),e.jsxs("p",{className:"font-semibold text-green-900 whitespace-nowrap text-sm",children:["â‚¹",t.product.price*t.quantity]})]},t.product._id)})}),e.jsxs("div",{className:"border-t border-green-200 pt-2.5 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["â‚¹",w]})]}),B&&e.jsxs("div",{className:"flex justify-between text-sm text-green-700 bg-green-100 -mx-1 px-2 py-1.5 rounded",children:[e.jsxs("span",{className:"font-medium",children:["ðŸŽ‰ ",B.code]}),e.jsxs("span",{className:"font-semibold",children:["-â‚¹",W]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Delivery"}),e.jsx("span",{className:"font-medium",children:0===Z?"ðŸŽ Free":"â‚¹".concat(Z)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-green-300",children:[e.jsx("span",{className:"text-base font-bold text-green-900",children:"Total"}),e.jsxs("span",{className:"text-xl font-bold text-green-900",children:["â‚¹",ee]})]}),J&&J.enabled&&J.cities&&(()=>{const t=J,r=(Q.address.city||"").toLowerCase(),s=t.cities.find(e=>e.name.toLowerCase()===r);return s&&s.freeDeliveryThreshold>0&&X<s.freeDeliveryThreshold?e.jsxs("p",{className:"text-xs text-amber-700 bg-amber-50 px-2 py-1.5 rounded",children:["Free delivery over â‚¹",s.freeDeliveryThreshold]}):null})(),!Q.address.city&&e.jsx("p",{className:"text-xs text-red-700 bg-red-50 px-2 py-1.5 rounded mt-2",children:"Please select a delivery city"})]})]})]}),e.jsx("div",{className:"flex-shrink-0 border-t-2 border-green-200 bg-gradient-to-t from-white to-green-50 px-4 py-3 shadow-2xl",children:e.jsx("button",{type:"button",onClick:re,disabled:M||te>0||!Q.address.city,className:"w-full py-4 rounded-2xl font-bold text-base transition-all ".concat(M||te>0||!Q.address.city?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg active:scale-95"),children:M?"â³ Placing Order...":"ðŸ›’ Place Order"})})]}),e.jsx(v,{isOpen:_,onClose:()=>L(!1),coupons:$,totalAmount:w,appliedCode:(null==B?void 0:B.code)||null,onApply:e=>{var t,r,s,a;Y({code:e.code,discountType:e.discountType,discountValue:e.discountValue,minOrderValue:null!=(t=e.minOrderValue)?t:null,maxDiscount:null!=(r=e.maxDiscount)?r:null,startsAt:null!=(s=e.startsAt)?s:null,expiresAt:null!=(a=e.expiresAt)?a:null,isActive:e.isActive})}})]})}export{j as CheckoutPage};
